<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Perfetto 使用指南 - 文韬的文档</title><meta name=author content="阿豪"><meta name=description content="1. Perfetto 是什么？ Perfetto 是 google 从 Android10 开始引入的一个全新的平台级跟踪分析工具。它可以记录 Android 系统运行过程中的关键数据，并通过图形化的形式展示这些数据。Perfetto 不仅可用于系统级的性能分析，也是我们学习系统源码流程的好帮手。
"><meta name=keywords content='clippings,转载,工具,blog'><meta itemprop=name content="Perfetto 使用指南"><meta itemprop=description content="1. Perfetto 是什么？ Perfetto 是 google 从 Android10 开始引入的一个全新的平台级跟踪分析工具。它可以记录 Android 系统运行过程中的关键数据，并通过图形化的形式展示这些数据。Perfetto 不仅可用于系统级的性能分析，也是我们学习系统源码流程的好帮手。"><meta itemprop=datePublished content="2024-11-06T06:57:56+00:00"><meta itemprop=dateModified content="2024-11-05T01:34:01+00:00"><meta itemprop=wordCount content="5285"><meta itemprop=keywords content="Clippings,转载,工具,Blog"><meta property="og:url" content="https://huang8604.github.io/posts/perfetto-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"><meta property="og:site_name" content="文韬的文档"><meta property="og:title" content="Perfetto 使用指南"><meta property="og:description" content="1. Perfetto 是什么？ Perfetto 是 google 从 Android10 开始引入的一个全新的平台级跟踪分析工具。它可以记录 Android 系统运行过程中的关键数据，并通过图形化的形式展示这些数据。Perfetto 不仅可用于系统级的性能分析，也是我们学习系统源码流程的好帮手。"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-06T06:57:56+00:00"><meta property="article:modified_time" content="2024-11-05T01:34:01+00:00"><meta property="article:tag" content="Clippings"><meta property="article:tag" content="转载"><meta property="article:tag" content="工具"><meta property="article:tag" content="Blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Perfetto 使用指南"><meta name=twitter:description content="1. Perfetto 是什么？ Perfetto 是 google 从 Android10 开始引入的一个全新的平台级跟踪分析工具。它可以记录 Android 系统运行过程中的关键数据，并通过图形化的形式展示这些数据。Perfetto 不仅可用于系统级的性能分析，也是我们学习系统源码流程的好帮手。"><meta name=application-name content="文涛的记录"><meta name=apple-mobile-web-app-title content="文涛的记录"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical type=text/html href=https://huang8604.github.io/posts/perfetto-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/ title="Perfetto 使用指南 - 文韬的文档"><link rel=prev type=text/html href=https://huang8604.github.io/posts/%E8%AE%A4%E8%AF%86%E7%AA%97%E5%8F%A3-%E7%AA%97%E5%8F%A3%E6%A8%A1%E5%BC%8F-%E7%AA%97%E5%8F%A3%E5%B1%82%E7%BA%A7android-12-csdn%E5%8D%9A%E5%AE%A2/ title="【Android 12】认识窗口_android 窗口模式 窗口层级-CSDN博客"><link rel=next type=text/html href=https://huang8604.github.io/posts/dataview-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/ title="dataview 使用技巧"><link rel=alternate type=text/markdown href=https://huang8604.github.io/posts/perfetto-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/index.md title="Perfetto 使用指南 - 文韬的文档"><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Perfetto 使用指南","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/huang8604.github.io\/posts\/perfetto-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97\/"},"genre":"posts","keywords":"clippings, 转载, 工具, blog","wordcount":5285,"url":"https:\/\/huang8604.github.io\/posts\/perfetto-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97\/","datePublished":"2024-11-06T06:57:56+00:00","dateModified":"2024-11-05T01:34:01+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"阿豪"},"description":""}</script><script src=/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=wide><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=文韬的文档><img class=logo src=/images/doc.jpg alt=文韬的文档 height=32 width=32><span class=header-title-text>文韬的文档</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=文韬的文档><img class=logo src=/images/doc.jpg alt=文韬的文档 height=26 width=26><span class=header-title-text>文韬的文档</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Perfetto 使用指南</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
阿豪</span></span><span class=post-included-in>&nbsp;收录于 <a href=/collections/%E5%B7%A5%E5%85%B7/ class=post-collection title="合集 - 工具"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> 工具</a></span></div><div class=post-meta-line><span title="发布于 2024-11-06 06:57:56"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2024-11-06>2024-11-06</time></span>&nbsp;<span title="更新于 2024-11-05 01:34:01"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=2024-11-05>2024-11-05</time></span>&nbsp;<span title="5285 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 5300 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 11 分钟</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-perfetto-是什么>1. Perfetto 是什么？</a></li><li><a href=#2-如何抓取-trace>2. 如何抓取 Trace</a><ul><li><a href=#21-使用命令行抓取-trace>2.1 使用命令行抓取 Trace</a><ul><li><a href=#211-使用-perfetto-命令抓取>2.1.1 使用 perfetto 命令抓取</a></li><li><a href=#212-使用-record_android_trace-命令抓取>2.1.2 使用 record_android_trace 命令抓取</a></li></ul></li><li><a href=#22-使用-ui-工具抓取>2.2 使用 UI 工具抓取</a><ul><li><a href=#221-perfetto-ui-抓取>2.2.1 Perfetto UI 抓取</a></li></ul></li><li><a href=#23-使用配置文件简化命令行抓取>2.3 使用配置文件简化命令行抓取</a></li></ul></li><li><a href=#3-perfetto-使用基础>3. Perfetto 使用基础</a><ul><li><a href=#31-进入-perfetto-trace-界面>3.1 进入 Perfetto Trace 界面</a></li><li><a href=#32-perfetto-trace-界面基本内容>3.2 Perfetto Trace 界面基本内容</a></li><li><a href=#321-slice片段>3.2.1 slice，片段</a><ul><li><a href=#线程状态查看>线程状态查看</a><ul><li><a href=#深绿色--运行中running>深绿色 : 运行中（Running）</a></li><li><a href=#浅绿色--可运行runnable>浅绿色 : 可运行（Runnable）</a></li><li><a href=#白色无色-睡眠中sleeping>白色/无色: 睡眠中（Sleeping）</a></li><li><a href=#橙色uninterruptible-sleep-io>橙色Uninterruptible Sleep (IO)</a></li><li><a href=#紫红色uninterruptible-sleep-non-io>紫红色Uninterruptible Sleep (Non IO)</a></li></ul></li></ul></li><li><a href=#322-counter计数器>3.2.2 counter，计数器</a></li><li><a href=#323-cpu-sched-slice-cpu-调度片段>3.2.3 CPU Sched Slice， cpu 调度片段</a></li><li><a href=#324-thread_state线程状态>3.2.4 thread_state，线程状态</a></li><li><a href=#33-perfetto-trace-界面基本操作>3.3 Perfetto Trace 界面基本操作</a><ul><li><ul><li><a href=#34-跨进程通讯的发起端与接受端跳转>3.4 跨进程通讯的发起端与接受端跳转</a></li></ul></li></ul></li></ul></li><li><a href=#4-如何添加trace-log>4. 如何添加trace Log</a><ul><li><a href=#41-使用atrace相关类方法介绍>4.1 使用atrace相关类方法介绍</a></li><li><a href=#42-比如常见的几个方法>4.2 比如常见的几个方法：</a><ul><li><a href=#421-atrace_call>4.2.1 ATRACE_CALL()</a></li><li><a href=#422-atrace_name方法>4.2.2 ATRACE_NAME方法</a></li><li><a href=#423-trace相关实战使用>4.2.3 trace相关实战使用：</a></li></ul></li><li><a href=#43-java端的trace打印>4.3 java端的trace打印</a></li></ul></li><li><a href=#参考资料>参考资料</a></li></ul></nav></div></div><div class=content id=content><h2 class=heading-element id=1-perfetto-是什么><span>1. Perfetto 是什么？</span>
<a href=#1-perfetto-%e6%98%af%e4%bb%80%e4%b9%88 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>Perfetto 是 google 从 Android10 开始引入的一个全新的平台级跟踪分析工具。它可以记录 Android 系统运行过程中的关键数据，并通过图形化的形式展示这些数据。Perfetto 不仅可用于系统级的性能分析，也是我们学习系统源码流程的好帮手。</p><p>Perfetto 算是Systrace的升级版本，可以直观的看到跨进程的调用方式。</p><h2 class=heading-element id=2-如何抓取-trace><span>2. 如何抓取 Trace</span>
<a href=#2-%e5%a6%82%e4%bd%95%e6%8a%93%e5%8f%96-trace class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>使用 Perfetto 一般分两步进行：</p><ul><li>收集手机运行过程中的信息，这些信息通常称之为 Trace，收集的过程称之为抓取 Trace。</li><li>使用 Perfetto 打开 Trace，分析 Trace</li></ul><p>本节介绍如何抓取 Trace 。</p><h3 class=heading-element id=21-使用命令行抓取-trace><span>2.1 使用命令行抓取 Trace</span>
<a href=#21-%e4%bd%bf%e7%94%a8%e5%91%bd%e4%bb%a4%e8%a1%8c%e6%8a%93%e5%8f%96-trace class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 class=heading-element id=211-使用-perfetto-命令抓取><span>2.1.1 使用 perfetto 命令抓取</span>
<a href=#211-%e4%bd%bf%e7%94%a8-perfetto-%e5%91%bd%e4%bb%a4%e6%8a%93%e5%8f%96 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>首先使用 usb 线将电脑和手机连接，确保 <code>adb shell</code> 命令能正常工作。</p><p>接着执行下面的命令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>adb shell perfetto -o /data/misc/perfetto-traces/trace_file.perfetto-trace t 20s <span class=se>\ </span>
</span></span><span class=line><span class=cl>sched freq idle am wm gfx view binder_driver hal dalvik camera input res memory</span></span></code></pre></td></tr></table></div></div><p>这个命令会启动一个 20 秒钟的跟踪，收集指定的数据源信息，并将跟踪文件保存到 <code>/data/misc/perfetto-traces/trace_file.perfetto-trace</code> ,执行完会在后台执行。</p><p>最后，把 trace 文件 pull 出来：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>adb pull /data/misc/perfetto-traces/trace_file.perfetto-trace</span></span></code></pre></td></tr></table></div></div><p>整个抓取过程就完成了。</p><p>也可以做成手机的内置的功能，执行shell命令来离线抓去trace。</p><h4 class=heading-element id=212-使用-record_android_trace-命令抓取><span>2.1.2 使用 record_android_trace 命令抓取</span>
<a href=#212-%e4%bd%bf%e7%94%a8-record_android_trace-%e5%91%bd%e4%bb%a4%e6%8a%93%e5%8f%96 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>record_android_trace 是 Perfetto 团队提供的一个简化脚本，使得我们的抓取工作更加简单。record_android_trace 在源码路径下面也有。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl -O https://raw.githubusercontent.com/google/perfetto/master/tools/record_android_tracechmod u+x record_android_trace
</span></span><span class=line><span class=cl>./record_android_trace -o trace_file.perfetto-trace -t 10s -b 64mb <span class=se>\ </span>
</span></span><span class=line><span class=cl>sched freq idle am wm gfx view binder_driver hal dalvik camera input res memory</span></span></code></pre></td></tr></table></div></div><p>record_android_trace 命令能自动处理好路径，抓取完成后自动打开 Trace 文件。</p><h3 class=heading-element id=22-使用-ui-工具抓取><span>2.2 使用 UI 工具抓取</span>
<a href=#22-%e4%bd%bf%e7%94%a8-ui-%e5%b7%a5%e5%85%b7%e6%8a%93%e5%8f%96 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 class=heading-element id=221-perfetto-ui-抓取><span>2.2.1 Perfetto UI 抓取</span>
<a href=#221-perfetto-ui-%e6%8a%93%e5%8f%96 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>Perfetto 也提供了图形化的工具来抓取 Trace。</p><p>该工具以网站的方式提供：<em><a href=https://ui.perfetto.dev/#!/record target=_blank rel="external nofollow noopener noreferrer">https://ui.perfetto.dev/#!/record</a></em></p><p>打开后，第一步，完成基本的设置：</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/671213b7ae95e.png title=14be9842a24628a0f3f6a6580e1aba4a\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/671213b7ae95e.png data-sub-html="<h2>14be9842a24628a0f3f6a6580e1aba4a\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/671213b7ae95e.png alt=14be9842a24628a0f3f6a6580e1aba4a\_MD5></a></p><ul><li><p>左侧 tab 栏，选择 Record new trace 选项。</p></li><li><p>使用 usb 线连接好手机和电脑后，选项好目标平台。</p></li><li><p>选择抓取的模式。</p></li><li><p>Stop when full，抓取的 trace 达到设置的容量后就停止。</p></li><li><p>Ring buffer，环形缓存，设置的容量满了后会被覆盖。</p></li><li><p>Long Trace，任性，一直记录。</p></li></ul><p>第二步，配置我们要抓取的内容：</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/671213fc924af.png title=4168204c70695e02a742eb4785e754b3\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/671213fc924af.png data-sub-html="<h2>4168204c70695e02a742eb4785e754b3\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/671213fc924af.png alt=4168204c70695e02a742eb4785e754b3\_MD5></a></p><p>箭头指向的内容全部选中，这部分主要是 App 相关的内容。</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/6712145dc5501.png title=82e01b3a7264c8ac5038fdd9d7bab939\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/6712145dc5501.png data-sub-html="<h2>82e01b3a7264c8ac5038fdd9d7bab939\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/6712145dc5501.png alt=82e01b3a7264c8ac5038fdd9d7bab939\_MD5></a></p><p>把调用栈选上，这对我们分析代码很有帮助。</p><p>最后点击，右上角的 <code>Start Recording</code> 就开始抓取了。</p><h3 class=heading-element id=23-使用配置文件简化命令行抓取><span>2.3 使用配置文件简化命令行抓取</span>
<a href=#23-%e4%bd%bf%e7%94%a8%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e7%ae%80%e5%8c%96%e5%91%bd%e4%bb%a4%e8%a1%8c%e6%8a%93%e5%8f%96 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>在使用 Perfetto UI 抓取时，当我们配置好以后。</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/6712147cedee9.png title=d4dffdfeb318a54a093ccbb6b8135f5c\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/6712147cedee9.png data-sub-html="<h2>d4dffdfeb318a54a093ccbb6b8135f5c\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/6712147cedee9.png alt=d4dffdfeb318a54a093ccbb6b8135f5c\_MD5></a></p><p>进入到 <code>Recording command</code>，然后把右侧两个 <code>EOF</code> 之间的内容复制下来，保存在 config.pbtx 配置文件中。</p><p>接着就可以用这个配置文件来抓取 Trace 了：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>./record_android_trace -c config.pbtx -o trace_file.perfetto-trace -t 10s -b 64mb</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=3-perfetto-使用基础><span>3. Perfetto 使用基础</span>
<a href=#3-perfetto-%e4%bd%bf%e7%94%a8%e5%9f%ba%e7%a1%80 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=31-进入-perfetto-trace-界面><span>3.1 进入 Perfetto Trace 界面</span>
<a href=#31-%e8%bf%9b%e5%85%a5-perfetto-trace-%e7%95%8c%e9%9d%a2 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>使用 record_android_trace 命令或者 Perfetto UI 抓取 Trace 后，会自动打开 Perfetto Trace 界面。</p><p>使用 perfetto 命令抓取 Trace 后，需要手动打开 Perfetto Trace 界面。打开的方法如下：</p><p>使用浏览器打开 <a href=https://ui.perfetto.dev/ target=_blank rel="external nofollow noopener noreferrer">https://ui.perfetto.dev/</a>，界面如下：</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/6712154a372e3.png title=f8eeeade087c9011666e787e05601681\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/6712154a372e3.png data-sub-html="<h2>f8eeeade087c9011666e787e05601681\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/6712154a372e3.png alt=f8eeeade087c9011666e787e05601681\_MD5></a></p><p>可以把 trace 文件直接拖到浏览器中，也可以通过左上角的 <code>Open trace file</code> 打开 trace 文件。</p><h3 class=heading-element id=32-perfetto-trace-界面基本内容><span>3.2 Perfetto Trace 界面基本内容</span>
<a href=#32-perfetto-trace-%e7%95%8c%e9%9d%a2%e5%9f%ba%e6%9c%ac%e5%86%85%e5%ae%b9 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>Perfetto Trace 界面大致可分为 4 个区域：</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/67121568a29b5.png title=f431e40b92dd06021a9e5056464e17bc\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/67121568a29b5.png data-sub-html="<h2>f431e40b92dd06021a9e5056464e17bc\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/67121568a29b5.png alt=f431e40b92dd06021a9e5056464e17bc\_MD5></a></p><ul><li><p>操作区，主要用到 Current Trace 下的几个选项：</p></li><li><p>Show timeline ：显示当前 Trace，切到了别的界面之后，再点这个就会回到 Trace View 界面。</p></li><li><p>Query：写 SQL 查询语句和查看执行结果的地方。</p></li><li><p>Metrics：官方默认帮你写好的一些分析结果。</p></li><li><p>Info and stats ：当前 Trace 和手机 App 的一些信息。</p></li><li><p>信息区：时间与搜索。</p></li><li><p>Trace 内容区：图形化展示 Trace 的区域。</p></li><li><p>信息区：展示Trace 内容区中选择中的元素的详细信息。</p></li></ul><p>在 Trace 内容区中，可以通过 w/s 按键缩小放大界面， a/d 移动界面。</p><p>Trace 内容区中主要有以下一些元素：</p><h3 class=heading-element id=321-slice片段><span>3.2.1 slice，片段</span>
<a href=#321-slice%e7%89%87%e6%ae%b5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/67121645cbafe.png title=8334ab145a6a4ccb13646715fe1a7fe6\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/67121645cbafe.png data-sub-html="<h2>8334ab145a6a4ccb13646715fe1a7fe6\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/67121645cbafe.png alt=8334ab145a6a4ccb13646715fe1a7fe6\_MD5></a></p><p>鼠标单击后会有一个黑框包围住，信息区会显示相关信息：</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/67121653b7038.png title=531a7006d369ce8deba539bc8bca19c3\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/67121653b7038.png data-sub-html="<h2>531a7006d369ce8deba539bc8bca19c3\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/67121653b7038.png alt=531a7006d369ce8deba539bc8bca19c3\_MD5></a></p><p>slice 代表了一段代码的执行过程，起于 <code>Trace.traceBegin \ </code>，终于 <code>Trace.traceEnd \ ATRACE_END</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>  </span><span class=n>Trace</span><span class=p>.</span><span class=na>traceBegin</span><span class=p>(</span><span class=n>Trace</span><span class=p>.</span><span class=na>TRACE_TAG_ACTIVITY_MANAGER</span><span class=p>,</span><span class=w> </span><span class=s>&#34;bindApplication&#34;</span><span class=p>);</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>AppBindData</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>AppBindData</span><span class=p>)</span><span class=n>msg</span><span class=p>.</span><span class=na>obj</span><span class=p>;</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>handleBindApplication</span><span class=p>(</span><span class=n>data</span><span class=p>);</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>Trace</span><span class=p>.</span><span class=na>traceEnd</span><span class=p>(</span><span class=n>Trace</span><span class=p>.</span><span class=na>TRACE_TAG_ACTIVITY_MANAGER</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div><h4 class=heading-element id=线程状态查看><span>线程状态查看</span>
<a href=#%e7%ba%bf%e7%a8%8b%e7%8a%b6%e6%80%81%e6%9f%a5%e7%9c%8b class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><h5 class=heading-element id=深绿色--运行中running><span>深绿色 : 运行中（Running）</span>
<a href=#%e6%b7%b1%e7%bb%bf%e8%89%b2--%e8%bf%90%e8%a1%8c%e4%b8%adrunning class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>在Running状态就代表着处于<a href="https://so.csdn.net/so/search?q=cpu%5c&amp;spm=1001.2101.3001.7020" target=_blank rel="external nofollow noopener noreferrer">cpu</a>上的运行中<br>状态作用：看某个方法是否耗时，可以通过测量Running时间长短判断，也可以进行竞品对比看看cpu能力如何，或者前后对比各个大小核cpu影响方法的耗时</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/29/6720a936d4558.png title=26035b00bc9bc4bb3e9658df3a3f8f42\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/29/6720a936d4558.png data-sub-html="<h2>26035b00bc9bc4bb3e9658df3a3f8f42\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/29/6720a936d4558.png alt=26035b00bc9bc4bb3e9658df3a3f8f42\_MD5></a></p><h5 class=heading-element id=浅绿色--可运行runnable><span>浅绿色 : 可运行（Runnable）</span>
<a href=#%e6%b5%85%e7%bb%bf%e8%89%b2--%e5%8f%af%e8%bf%90%e8%a1%8crunnable class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>代表线程可以运行但当前没有真正运行中，需要等待 cpu 调度，这个时间长短代表着cpu调度快慢<br><strong>重要作用：点击Runnable这个块，下面信息会显示当前线程唤醒者是谁，即可以清楚知道整个线程之间唤醒逻辑。</strong></p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/29/6720a9383d0f3.png title=b16cdfc5d92701ed3ad9e618f68a816e\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/29/6720a9383d0f3.png data-sub-html="<h2>b16cdfc5d92701ed3ad9e618f68a816e\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/29/6720a9383d0f3.png alt=b16cdfc5d92701ed3ad9e618f68a816e\_MD5></a></p><h5 class=heading-element id=白色无色-睡眠中sleeping><span>白色/无色: 睡眠中（Sleeping）</span>
<a href=#%e7%99%bd%e8%89%b2%e6%97%a0%e8%89%b2-%e7%9d%a1%e7%9c%a0%e4%b8%adsleeping class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>代表当前线程没有工作可以做，等待<a href="https://so.csdn.net/so/search?q=%e4%ba%8b%e4%bb%b6%e9%a9%b1%e5%8a%a8%5c&amp;spm=1001.2101.3001.7020" target=_blank rel="external nofollow noopener noreferrer">事件驱动</a>干货，比如looper就是大部分时间睡眠，小部分时间有消息后处理消息</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93ba652f.png title=520824c7d42e49c3c06c60ae7aebd66b\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93ba652f.png data-sub-html="<h2>520824c7d42e49c3c06c60ae7aebd66b\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93ba652f.png alt=520824c7d42e49c3c06c60ae7aebd66b\_MD5></a></p><h5 class=heading-element id=橙色uninterruptible-sleep-io><span>橙色Uninterruptible Sleep (IO)</span>
<a href=#%e6%a9%99%e8%89%b2uninterruptible-sleep-io class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>代表不可以中断的休眠状态，一般线程在<a href="https://so.csdn.net/so/search?q=IO%e6%93%8d%e4%bd%9c%5c&amp;spm=1001.2101.3001.7020" target=_blank rel="external nofollow noopener noreferrer">IO操作</a>上阻塞了<br>不可中断状态实际上是系统对进程和硬件设备的一种保护机制。比如，当一个进程向磁盘读写数据时，为了保证数据的一致性，在得到磁盘回复前，它是不能被其他进程或者中断打断的。</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93cd6442.png title=545576891abf020bad7bd16d051c95c8\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93cd6442.png data-sub-html="<h2>545576891abf020bad7bd16d051c95c8\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93cd6442.png alt=545576891abf020bad7bd16d051c95c8\_MD5></a></p><h5 class=heading-element id=紫红色uninterruptible-sleep-non-io><span>紫红色Uninterruptible Sleep (Non IO)</span>
<a href=#%e7%b4%ab%e7%ba%a2%e8%89%b2uninterruptible-sleep-non-io class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>不可中断的休眠状态，非IO导致，在等内核锁。通常是低内存导致等待、各种各样的内核锁。</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93c2c532.png title=7b2def33d51543a87ab926f359e0443a\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93c2c532.png data-sub-html="<h2>7b2def33d51543a87ab926f359e0443a\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93c2c532.png alt=7b2def33d51543a87ab926f359e0443a\_MD5></a></p><p>Uninterruptible情况都可以点击后看到blocked方法是哪个</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Blocked function   jbd2_log_wait_commit</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=322-counter计数器><span>3.2.2 counter，计数器</span>
<a href=#322-counter%e8%ae%a1%e6%95%b0%e5%99%a8 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>用于记录一些关键数据。</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/67121780e45eb.png title=96a000924935d095ee6aaf7efd29576c\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/67121780e45eb.png data-sub-html="<h2>96a000924935d095ee6aaf7efd29576c\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/67121780e45eb.png alt=96a000924935d095ee6aaf7efd29576c\_MD5></a></p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/6712185cba4e3.png title=fecfd5f864712f49a4e1b12904dc6c63\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/6712185cba4e3.png data-sub-html="<h2>fecfd5f864712f49a4e1b12904dc6c63\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/6712185cba4e3.png alt=fecfd5f864712f49a4e1b12904dc6c63\_MD5></a></p><p>对应于代码中的 <code>Trace.traceCounter/ATRACE_INT</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    ATRACE_INT(ftl::Concat(&#34;HW_VSYNC_&#34;, displayIdOpt-&gt;value).c_str(),    displayData.vsyncTraceToggle);</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=323-cpu-sched-slice-cpu-调度片段><span>3.2.3 CPU Sched Slice， cpu 调度片段</span>
<a href=#323-cpu-sched-slice-cpu-%e8%b0%83%e5%ba%a6%e7%89%87%e6%ae%b5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>用于展示 cpu 的调度情况。</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/6712188122854.png title=9a7921b120e22cd98620b4a8bbfec902\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/6712188122854.png data-sub-html="<h2>9a7921b120e22cd98620b4a8bbfec902\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/6712188122854.png alt=9a7921b120e22cd98620b4a8bbfec902\_MD5></a></p><h3 class=heading-element id=324-thread_state线程状态><span>3.2.4 thread_state，线程状态</span>
<a href=#324-thread_state%e7%ba%bf%e7%a8%8b%e7%8a%b6%e6%80%81 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>点击片段上方线程调度信息片段(Running)，可以看到线程当前运行在哪个CPU上。</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/6712189c122fb.png title=71cb37357dd944ef0727f3b304d56339\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/6712189c122fb.png data-sub-html="<h2>71cb37357dd944ef0727f3b304d56339\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/6712189c122fb.png alt=71cb37357dd944ef0727f3b304d56339\_MD5></a></p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/671218b219c23.png title=1855f4b4fc05bda7df0b4eca44eb2a40\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/671218b219c23.png data-sub-html="<h2>1855f4b4fc05bda7df0b4eca44eb2a40\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/671218b219c23.png alt=1855f4b4fc05bda7df0b4eca44eb2a40\_MD5></a></p><p>点击信息区中的 <code>Running on CPU 7</code> 旁边的斜箭头：</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/67121b18e7ebc.png title=85f359462dfb6ed688bad374e631aca9\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/67121b18e7ebc.png data-sub-html="<h2>85f359462dfb6ed688bad374e631aca9\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/67121b18e7ebc.png alt=85f359462dfb6ed688bad374e631aca9\_MD5></a></p><p>可以在 CPU 调度中看到该运行片段。</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/67121b248d8ec.png title=164ea040fd0a573aca7e17d486dc9d70\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/67121b248d8ec.png data-sub-html="<h2>164ea040fd0a573aca7e17d486dc9d70\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/67121b248d8ec.png alt=164ea040fd0a573aca7e17d486dc9d70\_MD5></a></p><p>再次点击斜箭头，可以回到原来位置。</p><p>这里的 thread_state 实际是我们的主线程，由用户点击屏幕唤醒运行，实际很多线程都是由其他线程/进程唤醒的，比如在 CPU 调度中选择一个 Slice：</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/67121b57a58f3.png title=6d28a7173a13532d4c5bcf438682d7a8\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/67121b57a58f3.png data-sub-html="<h2>6d28a7173a13532d4c5bcf438682d7a8\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/67121b57a58f3.png alt=6d28a7173a13532d4c5bcf438682d7a8\_MD5></a></p><p>这里的意思是当前 thread 由 P（Process）<code>/system/bin/surfaceflinger [584]</code> 中的 T（Thread）<code>app [689]</code> 唤醒。</p><p>线程从就绪到运行延迟了 48us 381ns</p><h3 class=heading-element id=33-perfetto-trace-界面基本操作><span>3.3 Perfetto Trace 界面基本操作</span>
<a href=#33-perfetto-trace-%e7%95%8c%e9%9d%a2%e5%9f%ba%e6%9c%ac%e6%93%8d%e4%bd%9c class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>W : 放大 perfetto , 放大可以更好地看清局部细节<br>S : 缩小 perfetto, 缩小以查看整体<br>A : 左移<br>D : 右移<br>M : 高亮选中当前鼠标点击的段</p><p>F：快速放大到选择位置</p><p>SHIFT + 鼠标 可以拖动</p><p>用得最多的其实就是添加标记。</p><p>当我们选中一个片段时，点击 m，就可以做一个临时的标记，当标记另一个片段以后，前一个临时标记就会取消。</p><p>选中一个片段以后，如果点击 <code>shift + m</code>，就会添加一个普通标记。</p><p>标记以后，会出现两个小三角：</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/67121d3198f40.png title=a39994dcc7880ce89c75dc8f5b1f1ff8\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/67121d3198f40.png data-sub-html="<h2>a39994dcc7880ce89c75dc8f5b1f1ff8\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/67121d3198f40.png alt=a39994dcc7880ce89c75dc8f5b1f1ff8\_MD5></a></p><p>点击小三角后，信息区会出现一个 remove 按键：</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/18/67121d4397b76.png title=0d5aa3ecaff5b4ae5586642e819cfe2d\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/18/67121d4397b76.png data-sub-html="<h2>0d5aa3ecaff5b4ae5586642e819cfe2d\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/18/67121d4397b76.png alt=0d5aa3ecaff5b4ae5586642e819cfe2d\_MD5></a></p><p>点击即可取消。</p><h5 class=heading-element id=34-跨进程通讯的发起端与接受端跳转><span>3.4 跨进程通讯的发起端与接受端跳转</span>
<a href=#34-%e8%b7%a8%e8%bf%9b%e7%a8%8b%e9%80%9a%e8%ae%af%e7%9a%84%e5%8f%91%e8%b5%b7%e7%ab%af%e4%b8%8e%e6%8e%a5%e5%8f%97%e7%ab%af%e8%b7%b3%e8%bd%ac class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93d5ae91.png title=b18ce5a621a2d8b948b44b536a0e428c\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93d5ae91.png data-sub-html="<h2>b18ce5a621a2d8b948b44b536a0e428c\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93d5ae91.png alt=b18ce5a621a2d8b948b44b536a0e428c\_MD5></a></p><p>发起端如下，也可以直接点击跳转到接收端</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93c11c4d.png title=e63b2f2ff4e66ff2b51414f4572f6ff9\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93c11c4d.png data-sub-html="<h2>e63b2f2ff4e66ff2b51414f4572f6ff9\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93c11c4d.png alt=e63b2f2ff4e66ff2b51414f4572f6ff9\_MD5></a></p><h2 class=heading-element id=4-如何添加trace-log><span>4. 如何添加trace Log</span>
<a href=#4-%e5%a6%82%e4%bd%95%e6%b7%bb%e5%8a%a0trace-log class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=41-使用atrace相关类方法介绍><span>4.1 使用atrace相关类方法介绍</span>
<a href=#41-%e4%bd%bf%e7%94%a8atrace%e7%9b%b8%e5%85%b3%e7%b1%bb%e6%96%b9%e6%b3%95%e4%bb%8b%e7%bb%8d class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>这里还需要看对应的trace源码是最全面的<br>路径：system/core/libcutils/include/cutils/trace.h</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * Copyright (C) 2012 The Android Open Source Project
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span class=line><span class=cl><span class=cm> * you may not use this file except in compliance with the License.
</span></span></span><span class=line><span class=cl><span class=cm> * You may obtain a copy of the License at
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> *      http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * Unless required by applicable law or agreed to in writing, software
</span></span></span><span class=line><span class=cl><span class=cm> * distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span class=line><span class=cl><span class=cm> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span class=line><span class=cl><span class=cm> * See the License for the specific language governing permissions and
</span></span></span><span class=line><span class=cl><span class=cm> * limitations under the License.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>ifndef</span><span class=w> </span><span class=n>_LIBS_CUTILS_TRACE_H</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=n>_LIBS_CUTILS_TRACE_H</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>include</span><span class=w> </span><span class=o>&lt;</span><span class=n>inttypes</span><span class=p>.</span><span class=na>h</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>include</span><span class=w> </span><span class=o>&lt;</span><span class=n>stdatomic</span><span class=p>.</span><span class=na>h</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>include</span><span class=w> </span><span class=o>&lt;</span><span class=n>stdbool</span><span class=p>.</span><span class=na>h</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>include</span><span class=w> </span><span class=o>&lt;</span><span class=n>stdint</span><span class=p>.</span><span class=na>h</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>include</span><span class=w> </span><span class=o>&lt;</span><span class=n>stdio</span><span class=p>.</span><span class=na>h</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>include</span><span class=w> </span><span class=o>&lt;</span><span class=n>sys</span><span class=o>/</span><span class=n>cdefs</span><span class=p>.</span><span class=na>h</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>include</span><span class=w> </span><span class=o>&lt;</span><span class=n>sys</span><span class=o>/</span><span class=n>types</span><span class=p>.</span><span class=na>h</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>include</span><span class=w> </span><span class=o>&lt;</span><span class=n>unistd</span><span class=p>.</span><span class=na>h</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>include</span><span class=w> </span><span class=o>&lt;</span><span class=n>cutils</span><span class=o>/</span><span class=n>compiler</span><span class=p>.</span><span class=na>h</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>__BEGIN_DECLS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * The ATRACE_TAG macro can be defined before including this header to trace
</span></span></span><span class=line><span class=cl><span class=cm> * using one of the tags defined below.  It must be defined to one of the
</span></span></span><span class=line><span class=cl><span class=cm> * following ATRACE_TAG_* macros.  The trace tag is used to filter tracing in
</span></span></span><span class=line><span class=cl><span class=cm> * userland to avoid some of the runtime cost of tracing when it is not desired.
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * Defining ATRACE_TAG to be ATRACE_TAG_ALWAYS will result in the tracing always
</span></span></span><span class=line><span class=cl><span class=cm> * being enabled - this should ONLY be done for debug code, as userland tracing
</span></span></span><span class=line><span class=cl><span class=cm> * has a performance cost even when the trace is not being recorded.  Defining
</span></span></span><span class=line><span class=cl><span class=cm> * ATRACE_TAG to be ATRACE_TAG_NEVER or leaving ATRACE_TAG undefined will result
</span></span></span><span class=line><span class=cl><span class=cm> * in the tracing always being disabled.
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * ATRACE_TAG_HAL should be bitwise ORed with the relevant tags for tracing
</span></span></span><span class=line><span class=cl><span class=cm> * within a hardware module.  For example a camera hardware module would set:
</span></span></span><span class=line><span class=cl><span class=cm> * #define ATRACE_TAG  (ATRACE_TAG_CAMERA | ATRACE_TAG_HAL)
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * Keep these in sync with frameworks/base/core/java/android/os/Trace.java.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=n>ATRACE_TAG_NEVER</span><span class=w>            </span><span class=n>0</span><span class=w>       </span><span class=c1>// This tag is never enabled.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_ALWAYS</span><span class=w>           </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>0</span><span class=p>)</span><span class=w>  </span><span class=c1>// This tag is always enabled.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_GRAPHICS</span><span class=w>         </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_INPUT</span><span class=w>            </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_VIEW</span><span class=w>             </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>3</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_WEBVIEW</span><span class=w>          </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>4</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_WINDOW_MANAGER</span><span class=w>   </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>5</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_ACTIVITY_MANAGER</span><span class=w> </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>6</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_SYNC_MANAGER</span><span class=w>     </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>7</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_AUDIO</span><span class=w>            </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>8</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_VIDEO</span><span class=w>            </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>9</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_CAMERA</span><span class=w>           </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>10</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_HAL</span><span class=w>              </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>11</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_APP</span><span class=w>              </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>12</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_RESOURCES</span><span class=w>        </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>13</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_DALVIK</span><span class=w>           </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>14</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_RS</span><span class=w>               </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>15</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_BIONIC</span><span class=w>           </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>16</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_POWER</span><span class=w>            </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>17</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_PACKAGE_MANAGER</span><span class=w>  </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>18</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_SYSTEM_SERVER</span><span class=w>    </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>19</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_DATABASE</span><span class=w>         </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>20</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_NETWORK</span><span class=w>          </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>21</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_ADB</span><span class=w>              </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>22</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_VIBRATOR</span><span class=w>         </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>23</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_AIDL</span><span class=w>             </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>24</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_NNAPI</span><span class=w>            </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>25</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_RRO</span><span class=w>              </span><span class=p>(</span><span class=n>1</span><span class=o>&lt;&lt;</span><span class=n>26</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_THERMAL</span><span class=w>          </span><span class=p>(</span><span class=n>1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>27</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=n>ATRACE_TAG_LAST</span><span class=w>             </span><span class=n>ATRACE_TAG_THERMAL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Reserved for initialization.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_NOT_READY</span><span class=w>        </span><span class=p>(</span><span class=n>1ULL</span><span class=o>&lt;&lt;</span><span class=n>63</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_TAG_VALID_MASK</span><span class=w> </span><span class=p>((</span><span class=n>ATRACE_TAG_LAST</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>1</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>ATRACE_TAG_LAST</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>ifndef</span><span class=w> </span><span class=n>ATRACE_TAG</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=n>ATRACE_TAG</span><span class=w> </span><span class=n>ATRACE_TAG_NEVER</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>elif</span><span class=w> </span><span class=n>ATRACE_TAG</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>ATRACE_TAG_VALID_MASK</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>error</span><span class=w> </span><span class=n>ATRACE_TAG</span><span class=w> </span><span class=n>must</span><span class=w> </span><span class=n>be</span><span class=w> </span><span class=n>defined</span><span class=w> </span><span class=n>to</span><span class=w> </span><span class=n>be</span><span class=w> </span><span class=n>one</span><span class=w> </span><span class=n>of</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>tags</span><span class=w> </span><span class=n>defined</span><span class=w> </span><span class=n>in</span><span class=w> </span><span class=n>cutils</span><span class=o>/</span><span class=n>trace</span><span class=p>.</span><span class=na>h</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>endif</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Opens the trace file for writing and reads the property for initial tags.
</span></span></span><span class=line><span class=cl><span class=cm> * The atrace.tags.enableflags property sets the tags to trace.
</span></span></span><span class=line><span class=cl><span class=cm> * This function should not be explicitly called, the first call to any normal
</span></span></span><span class=line><span class=cl><span class=cm> * trace function will cause it to be run safely.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_setup</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * If tracing is ready, set atrace_enabled_tags to the system property
</span></span></span><span class=line><span class=cl><span class=cm> * debug.atrace.tags.enableflags. Can be used as a sysprop change callback.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_update_tags</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Set whether tracing is enabled for the current process.  This is used to
</span></span></span><span class=line><span class=cl><span class=cm> * prevent tracing within the Zygote process.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_set_tracing_enabled</span><span class=p>(</span><span class=n>bool</span><span class=w> </span><span class=n>enabled</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * This is always set to false. This forces code that uses an old version
</span></span></span><span class=line><span class=cl><span class=cm> * of this header to always call into atrace_setup, in which we call
</span></span></span><span class=line><span class=cl><span class=cm> * atrace_init unconditionally.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>extern</span><span class=w> </span><span class=n>atomic_bool</span><span class=w> </span><span class=n>atrace_is_ready</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Set of ATRACE_TAG flags to trace for, initialized to ATRACE_TAG_NOT_READY.
</span></span></span><span class=line><span class=cl><span class=cm> * A value of zero indicates setup has failed.
</span></span></span><span class=line><span class=cl><span class=cm> * Any other nonzero value indicates setup has succeeded, and tracing is on.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>extern</span><span class=w> </span><span class=n>uint64_t</span><span class=w> </span><span class=n>atrace_enabled_tags</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Handle to the kernel&#39;s trace buffer, initialized to -1.
</span></span></span><span class=line><span class=cl><span class=cm> * Any other value indicates setup has succeeded, and is a valid fd for tracing.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>extern</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>atrace_marker_fd</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * atrace_init readies the process for tracing by opening the trace_marker file.
</span></span></span><span class=line><span class=cl><span class=cm> * Calling any trace function causes this to be run, so calling it is optional.
</span></span></span><span class=line><span class=cl><span class=cm> * This can be explicitly run to avoid setup delay on first trace function.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_INIT</span><span class=p>()</span><span class=w> </span><span class=n>atrace_init</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_GET_ENABLED_TAGS</span><span class=p>()</span><span class=w> </span><span class=n>atrace_get_enabled_tags</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_init</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>uint64_t</span><span class=w> </span><span class=nf>atrace_get_enabled_tags</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Test if a given tag is currently enabled.
</span></span></span><span class=line><span class=cl><span class=cm> * Returns nonzero if the tag is enabled, otherwise zero.
</span></span></span><span class=line><span class=cl><span class=cm> * It can be used as a guard condition around more expensive trace calculations.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_ENABLED</span><span class=p>()</span><span class=w> </span><span class=n>atrace_is_tag_enabled</span><span class=p>(</span><span class=n>ATRACE_TAG</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=n>inline</span><span class=w> </span><span class=n>uint64_t</span><span class=w> </span><span class=nf>atrace_is_tag_enabled</span><span class=p>(</span><span class=n>uint64_t</span><span class=w> </span><span class=n>tag</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>atrace_get_enabled_tags</span><span class=p>()</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>tag</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Trace the beginning of a context.  name is used to identify the context.
</span></span></span><span class=line><span class=cl><span class=cm> * This is often used to time function execution.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_BEGIN</span><span class=p>(</span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=n>atrace_begin</span><span class=p>(</span><span class=n>ATRACE_TAG</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=n>inline</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_begin</span><span class=p>(</span><span class=n>uint64_t</span><span class=w> </span><span class=n>tag</span><span class=p>,</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>CC_UNLIKELY</span><span class=p>(</span><span class=n>atrace_is_tag_enabled</span><span class=p>(</span><span class=n>tag</span><span class=p>)))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_begin_body</span><span class=p>(</span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>atrace_begin_body</span><span class=p>(</span><span class=n>name</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Trace the end of a context.
</span></span></span><span class=line><span class=cl><span class=cm> * This should match up (and occur after) a corresponding ATRACE_BEGIN.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_END</span><span class=p>()</span><span class=w> </span><span class=n>atrace_end</span><span class=p>(</span><span class=n>ATRACE_TAG</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=n>inline</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_end</span><span class=p>(</span><span class=n>uint64_t</span><span class=w> </span><span class=n>tag</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>CC_UNLIKELY</span><span class=p>(</span><span class=n>atrace_is_tag_enabled</span><span class=p>(</span><span class=n>tag</span><span class=p>)))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_end_body</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>atrace_end_body</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Trace the beginning of an asynchronous event. Unlike ATRACE_BEGIN/ATRACE_END
</span></span></span><span class=line><span class=cl><span class=cm> * contexts, asynchronous events do not need to be nested. The name describes
</span></span></span><span class=line><span class=cl><span class=cm> * the event, and the cookie provides a unique identifier for distinguishing
</span></span></span><span class=line><span class=cl><span class=cm> * simultaneous events. The name and cookie used to begin an event must be
</span></span></span><span class=line><span class=cl><span class=cm> * used to end it.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_ASYNC_BEGIN</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>cookie</span><span class=p>)</span><span class=w> </span><span class=err>\</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>atrace_async_begin</span><span class=p>(</span><span class=n>ATRACE_TAG</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>cookie</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=n>inline</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_async_begin</span><span class=p>(</span><span class=n>uint64_t</span><span class=w> </span><span class=n>tag</span><span class=p>,</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>int32_t</span><span class=w> </span><span class=n>cookie</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>CC_UNLIKELY</span><span class=p>(</span><span class=n>atrace_is_tag_enabled</span><span class=p>(</span><span class=n>tag</span><span class=p>)))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_async_begin_body</span><span class=p>(</span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=n>int32_t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>atrace_async_begin_body</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>cookie</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Trace the end of an asynchronous event.
</span></span></span><span class=line><span class=cl><span class=cm> * This should have a corresponding ATRACE_ASYNC_BEGIN.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_ASYNC_END</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>cookie</span><span class=p>)</span><span class=w> </span><span class=n>atrace_async_end</span><span class=p>(</span><span class=n>ATRACE_TAG</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>cookie</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=n>inline</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_async_end</span><span class=p>(</span><span class=n>uint64_t</span><span class=w> </span><span class=n>tag</span><span class=p>,</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>int32_t</span><span class=w> </span><span class=n>cookie</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>CC_UNLIKELY</span><span class=p>(</span><span class=n>atrace_is_tag_enabled</span><span class=p>(</span><span class=n>tag</span><span class=p>)))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_async_end_body</span><span class=p>(</span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=n>int32_t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>atrace_async_end_body</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>cookie</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Trace the beginning of an asynchronous event. In addition to the name and a
</span></span></span><span class=line><span class=cl><span class=cm> * cookie as in ATRACE_ASYNC_BEGIN/ATRACE_ASYNC_END, a track name argument is
</span></span></span><span class=line><span class=cl><span class=cm> * provided, which is the name of the row where this async event should be
</span></span></span><span class=line><span class=cl><span class=cm> * recorded. The track name, name, and cookie used to begin an event must be
</span></span></span><span class=line><span class=cl><span class=cm> * used to end it.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_ASYNC_FOR_TRACK_BEGIN</span><span class=p>(</span><span class=n>track_name</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>cookie</span><span class=p>)</span><span class=w> </span><span class=err>\</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>atrace_async_for_track_begin</span><span class=p>(</span><span class=n>ATRACE_TAG</span><span class=p>,</span><span class=w> </span><span class=n>track_name</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>cookie</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=n>inline</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_async_for_track_begin</span><span class=p>(</span><span class=n>uint64_t</span><span class=w> </span><span class=n>tag</span><span class=p>,</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>track_name</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                                </span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>int32_t</span><span class=w> </span><span class=n>cookie</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>CC_UNLIKELY</span><span class=p>(</span><span class=n>atrace_is_tag_enabled</span><span class=p>(</span><span class=n>tag</span><span class=p>)))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_async_for_track_begin_body</span><span class=p>(</span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=n>int32_t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>atrace_async_for_track_begin_body</span><span class=p>(</span><span class=n>track_name</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>cookie</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Trace the end of an asynchronous event.
</span></span></span><span class=line><span class=cl><span class=cm> * This should correspond to a previous ATRACE_ASYNC_FOR_TRACK_BEGIN.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_ASYNC_FOR_TRACK_END</span><span class=p>(</span><span class=n>track_name</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>cookie</span><span class=p>)</span><span class=w> </span><span class=err>\</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>atrace_async_for_track_end</span><span class=p>(</span><span class=n>ATRACE_TAG</span><span class=p>,</span><span class=w> </span><span class=n>track_name</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>cookie</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=n>inline</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_async_for_track_end</span><span class=p>(</span><span class=n>uint64_t</span><span class=w> </span><span class=n>tag</span><span class=p>,</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>track_name</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                              </span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>int32_t</span><span class=w> </span><span class=n>cookie</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>CC_UNLIKELY</span><span class=p>(</span><span class=n>atrace_is_tag_enabled</span><span class=p>(</span><span class=n>tag</span><span class=p>)))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_async_for_track_end_body</span><span class=p>(</span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=n>int32_t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>atrace_async_for_track_end_body</span><span class=p>(</span><span class=n>track_name</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>cookie</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Trace an instantaneous context. name is used to identify the context.
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * An &#34;instant&#34; is an event with no defined duration. Visually is displayed like a single marker
</span></span></span><span class=line><span class=cl><span class=cm> * in the timeline (rather than a span, in the case of begin/end events).
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * By default, instant events are added into a dedicated track that has the same name of the event.
</span></span></span><span class=line><span class=cl><span class=cm> * Use atrace_instant_for_track to put different instant events into the same timeline track/row.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_INSTANT</span><span class=p>(</span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=n>atrace_instant</span><span class=p>(</span><span class=n>ATRACE_TAG</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=n>inline</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_instant</span><span class=p>(</span><span class=n>uint64_t</span><span class=w> </span><span class=n>tag</span><span class=p>,</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>CC_UNLIKELY</span><span class=p>(</span><span class=n>atrace_is_tag_enabled</span><span class=p>(</span><span class=n>tag</span><span class=p>)))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_instant_body</span><span class=p>(</span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>atrace_instant_body</span><span class=p>(</span><span class=n>name</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Trace an instantaneous context. name is used to identify the context.
</span></span></span><span class=line><span class=cl><span class=cm> * track_name is the name of the row where the event should be recorded.
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * An &#34;instant&#34; is an event with no defined duration. Visually is displayed like a single marker
</span></span></span><span class=line><span class=cl><span class=cm> * in the timeline (rather than a span, in the case of begin/end events).
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_INSTANT_FOR_TRACK</span><span class=p>(</span><span class=n>trackName</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=err>\</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>atrace_instant_for_track</span><span class=p>(</span><span class=n>ATRACE_TAG</span><span class=p>,</span><span class=w> </span><span class=n>trackName</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=n>inline</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_instant_for_track</span><span class=p>(</span><span class=n>uint64_t</span><span class=w> </span><span class=n>tag</span><span class=p>,</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>track_name</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                            </span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>CC_UNLIKELY</span><span class=p>(</span><span class=n>atrace_is_tag_enabled</span><span class=p>(</span><span class=n>tag</span><span class=p>)))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_instant_for_track_body</span><span class=p>(</span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>atrace_instant_for_track_body</span><span class=p>(</span><span class=n>track_name</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Traces an integer counter value.  name is used to identify the counter.
</span></span></span><span class=line><span class=cl><span class=cm> * This can be used to track how a value changes over time.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_INT</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>)</span><span class=w> </span><span class=n>atrace_int</span><span class=p>(</span><span class=n>ATRACE_TAG</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=n>inline</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_int</span><span class=p>(</span><span class=n>uint64_t</span><span class=w> </span><span class=n>tag</span><span class=p>,</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>int32_t</span><span class=w> </span><span class=n>value</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>CC_UNLIKELY</span><span class=p>(</span><span class=n>atrace_is_tag_enabled</span><span class=p>(</span><span class=n>tag</span><span class=p>)))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_int_body</span><span class=p>(</span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=n>int32_t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>atrace_int_body</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Traces a 64-bit integer counter value.  name is used to identify the
</span></span></span><span class=line><span class=cl><span class=cm> * counter. This can be used to track how a value changes over time.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>define</span><span class=w> </span><span class=nf>ATRACE_INT64</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>)</span><span class=w> </span><span class=n>atrace_int64</span><span class=p>(</span><span class=n>ATRACE_TAG</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=n>inline</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_int64</span><span class=p>(</span><span class=n>uint64_t</span><span class=w> </span><span class=n>tag</span><span class=p>,</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>int64_t</span><span class=w> </span><span class=n>value</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>CC_UNLIKELY</span><span class=p>(</span><span class=n>atrace_is_tag_enabled</span><span class=p>(</span><span class=n>tag</span><span class=p>)))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>void</span><span class=w> </span><span class=nf>atrace_int64_body</span><span class=p>(</span><span class=kd>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=n>int64_t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>atrace_int64_body</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>__END_DECLS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>endif</span><span class=w> </span><span class=o>//</span><span class=w> </span><span class=n>_LIBS_CUTILS_TRACE_H</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=42-比如常见的几个方法><span>4.2 比如常见的几个方法：</span>
<a href=#42-%e6%af%94%e5%a6%82%e5%b8%b8%e8%a7%81%e7%9a%84%e5%87%a0%e4%b8%aa%e6%96%b9%e6%b3%95 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 class=heading-element id=421-atrace_call><span>4.2.1 ATRACE_CALL()</span>
<a href=#421-atrace_call class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>这个方法，代表对一个function的开头和结尾进行tag，它的源码如下<br>#define ATRACE_CALL() ATRACE_NAME(<strong>FUNCTION</strong>)<br>即本质调用的是ATRACE_NAME</p><h4 class=heading-element id=422-atrace_name方法><span>4.2.2 ATRACE_NAME方法</span>
<a href=#422-atrace_name%e6%96%b9%e6%b3%95 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>调用如下：</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93b6639d.png title=f41d5bab5ad75815f82682d93be190be\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93b6639d.png data-sub-html="<h2>f41d5bab5ad75815f82682d93be190be\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93b6639d.png alt=f41d5bab5ad75815f82682d93be190be\_MD5></a></p><p>效果如下：</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93adec33.png title=b762eb06df9418207b5208ae07ebf7b0\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93adec33.png data-sub-html="<h2>b762eb06df9418207b5208ae07ebf7b0\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93adec33.png alt=b762eb06df9418207b5208ae07ebf7b0\_MD5></a></p><h4 class=heading-element id=423-trace相关实战使用><span>4.2.3 trace相关实战使用：</span>
<a href=#423-trace%e7%9b%b8%e5%85%b3%e5%ae%9e%e6%88%98%e4%bd%bf%e7%94%a8 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>1、引入相关的头文件及相关库<br>#include &lt;utils/Trace.h><br>编译时候还得考率相关utils的lib是否引入<br>如这里以截图代码为例就有引入libutils<br>frameworks/base/cmds/screencap/Android.bp</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>cc_binary</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=p>:</span><span class=w> </span><span class=s>&#34;screencap&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nl>srcs</span><span class=p>:</span><span class=w> </span><span class=o>[</span><span class=s>&#34;screencap.cpp&#34;</span><span class=o>]</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nl>shared_libs</span><span class=p>:</span><span class=w> </span><span class=o>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;libcutils&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;libutils&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;libbinder&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;libjnigraphics&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;libui&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;libgui&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>]</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nl>cflags</span><span class=p>:</span><span class=w> </span><span class=o>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;-Wall&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;-Werror&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;-Wunused&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;-Wunreachable-code&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>]</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>2、定义好相关的TAG</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> #undef ATRACE_TAG
</span></span><span class=line><span class=cl>#define ATRACE_TAG ATRACE_TAG_GRAPHICS</span></span></code></pre></td></tr></table></div></div><p>这里就选了一个ATRACE_TAG_GRAPHICS即graphics这个组</p><p>3、调用相关actrace方法<br>ATRACE_CALL<br>ATRACE_NAME<br>一般针对整个方法或者单独作用域，ATRACE_CALL和ATRACE_NAME本质没有区别，只是把名字变成了function的name</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93b8bc0a.png title=2fd48ec7a226024f796c4c848f61b39f\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93b8bc0a.png data-sub-html="<h2>2fd48ec7a226024f796c4c848f61b39f\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93b8bc0a.png alt=2fd48ec7a226024f796c4c848f61b39f\_MD5></a></p><p>具体效果如下：</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93a5a949.png title=e8251e04016f6f68000afbd66587e411\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93a5a949.png data-sub-html="<h2>e8251e04016f6f68000afbd66587e411\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93a5a949.png alt=e8251e04016f6f68000afbd66587e411\_MD5></a></p><p>优点：只需要一个调用既可以实现tag打印，自动跟随作用域进行tag的结束<br>缺点：需要自己熟练掌握好作用域，没有可以手动控制的tag结束的点</p><p>4、相关灵活控制开始与结束的trace方法<br>直接使用atrace_begin和atrace_end方法，使用如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nl>GraphicBuffer</span><span class=p>::</span><span class=n>GraphicBuffer</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>:</span><span class=w> </span><span class=n>BASE</span><span class=p>(),</span><span class=w> </span><span class=n>mOwner</span><span class=p>(</span><span class=n>ownData</span><span class=p>),</span><span class=w> </span><span class=n>mBufferMapper</span><span class=p>(</span><span class=n>GraphicBufferMapper</span><span class=p>::</span><span class=n>get</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>mInitCheck</span><span class=p>(</span><span class=n>NO_ERROR</span><span class=p>),</span><span class=w> </span><span class=n>mId</span><span class=p>(</span><span class=n>getUniqueId</span><span class=p>()),</span><span class=w> </span><span class=n>mGenerationNumber</span><span class=p>(</span><span class=n>0</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ATRACE_NAME</span><span class=p>(</span><span class=s>&#34;GraphicBuffer::GraphicBuffer()1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>atrace_begin</span><span class=p>(</span><span class=n>ATRACE_TAG</span><span class=p>,</span><span class=w> </span><span class=s>&#34;GraphicBuffer 1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>width</span><span class=w>  </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>height</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>stride</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>format</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>usage_deprecated</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>atrace_end</span><span class=p>(</span><span class=n>ATRACE_TAG</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>usage</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>layerCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>handle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nullptr</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>同时也可以使用对应<a href="https://so.csdn.net/so/search?q=%e5%ae%8f%e5%ae%9a%e4%b9%89%5c&amp;spm=1001.2101.3001.7020" target=_blank rel="external nofollow noopener noreferrer">宏定义</a>：<br>ATRACE_BEGIN(name);<br>ATRACE_END();</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93ad7d83.png title=a888b7da3d14319a6175179e79f8cab9\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93ad7d83.png data-sub-html="<h2>a888b7da3d14319a6175179e79f8cab9\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93ad7d83.png alt=a888b7da3d14319a6175179e79f8cab9\_MD5></a><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93c82d24.png title=197ff0830a077cc075b59917cf894bb4\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93c82d24.png data-sub-html="<h2>197ff0830a077cc075b59917cf894bb4\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93c82d24.png alt=197ff0830a077cc075b59917cf894bb4\_MD5></a></p><p>执行后效果如下：</p><p><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93a3c766.png title=a947d73a381cd5c0c3a4a81f214b54d8\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93a3c766.png data-sub-html="<h2>a947d73a381cd5c0c3a4a81f214b54d8\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/29/6720a93a3c766.png alt=a947d73a381cd5c0c3a4a81f214b54d8\_MD5></a></p><h3 class=heading-element id=43-java端的trace打印><span>4.3 java端的trace打印</span>
<a href=#43-java%e7%ab%af%e7%9a%84trace%e6%89%93%e5%8d%b0 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>app层面时候也有trace打印方式</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>  </span><span class=n>Trace</span><span class=p>.</span><span class=na>traceBegin</span><span class=p>(</span><span class=n>Trace</span><span class=p>.</span><span class=na>TRACE_TAG_ALWAYS</span><span class=p>,</span><span class=s>&#34;aaaaa&#34;</span><span class=p>);</span><span class=c1>//开始trace 字符为aaaaa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>Trace</span><span class=p>.</span><span class=na>traceEnd</span><span class=p>(</span><span class=n>Trace</span><span class=p>.</span><span class=na>TRACE_TAG_ALWAYS</span><span class=p>);</span><span class=o>//</span><span class=n>结束trace</span></span></span></code></pre></td></tr></table></div></div><p>源码如下：<br>frameworks/base/core/java/android/os/Trace.java</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * Writes a trace message to indicate that a given section of code has
</span></span></span><span class=line><span class=cl><span class=cm>     * begun. Must be followed by a call to {@link #traceEnd} using the same
</span></span></span><span class=line><span class=cl><span class=cm>     * tag.
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param traceTag The trace tag.
</span></span></span><span class=line><span class=cl><span class=cm>     * @param methodName The method name to appear in the trace.
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @hide
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@UnsupportedAppUsage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@SystemApi</span><span class=p>(</span><span class=n>client</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MODULE_LIBRARIES</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>traceBegin</span><span class=p>(</span><span class=kt>long</span><span class=w> </span><span class=n>traceTag</span><span class=p>,</span><span class=w> </span><span class=nd>@NonNull</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>methodName</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>isTagEnabled</span><span class=p>(</span><span class=n>traceTag</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>nativeTraceBegin</span><span class=p>(</span><span class=n>traceTag</span><span class=p>,</span><span class=w> </span><span class=n>methodName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * Writes a trace message to indicate that the current method has ended.
</span></span></span><span class=line><span class=cl><span class=cm>     * Must be called exactly once for each call to {@link #traceBegin} using the same tag.
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param traceTag The trace tag.
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @hide
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@UnsupportedAppUsage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@SystemApi</span><span class=p>(</span><span class=n>client</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MODULE_LIBRARIES</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>traceEnd</span><span class=p>(</span><span class=kt>long</span><span class=w> </span><span class=n>traceTag</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>isTagEnabled</span><span class=p>(</span><span class=n>traceTag</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>nativeTraceEnd</span><span class=p>(</span><span class=n>traceTag</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>具体使用方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>protected</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onStart</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Trace</span><span class=p>.</span><span class=na>traceBegin</span><span class=p>(</span><span class=n>Trace</span><span class=p>.</span><span class=na>TRACE_TAG_ALWAYS</span><span class=p>,</span><span class=s>&#34;Settings Home onStart()&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>((</span><span class=n>SettingsApplication</span><span class=p>)</span><span class=w> </span><span class=n>getApplication</span><span class=p>()).</span><span class=na>setHomeActivity</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>onStart</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>doAidlHalCall</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Trace</span><span class=p>.</span><span class=na>traceEnd</span><span class=p>(</span><span class=n>Trace</span><span class=p>.</span><span class=na>TRACE_TAG_ALWAYS</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=参考资料><span>参考资料</span>
<a href=#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><ul><li>perfetto 官方文档</li><li>Android Perfetto 系列 1：Perfetto 工具简介</li><li>Android Perfetto 系列 3：熟悉 Perfetto View</li><li>Perfetto分析进阶</li><li>perfetto/systrace基础知识讲解</li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg5MzYxNTI5Mg==%5c&amp;mid=2247494899%5c&amp;idx=1%5c&amp;sn=7fe08dadfddc5298216070e3e8d31a3a%5c&amp;poc_token=HOaO2maj5PTkR2nB_uZVUnXaUUib2E6IlSfsU7Q_%5c&amp;scene=21#wechat_redirect" target=_blank rel="external nofollow noopener noreferrer">使用 Perfetto 分析你的 Android 应用性能</a></li></ul></div><div class=collection-card><div class="collection-title text-secondary">收录于 <a href=/collections/%E5%B7%A5%E5%85%B7/><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> <span>合集・工具</span></span></a> 1</div><div class=collection-nav></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2024-11-05 01:34:01">更新于 2024-11-05&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/perfetto-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://huang8604.github.io/posts/perfetto-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/ data-title="Perfetto 使用指南"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/clippings/ class=post-tag title="标签 - Clippings">Clippings</a><a href=/tags/%E8%BD%AC%E8%BD%BD/ class=post-tag title="标签 - 转载">转载</a><a href=/tags/%E5%B7%A5%E5%85%B7/ class=post-tag title="标签 - 工具">工具</a><a href=/tags/blog/ class=post-tag title="标签 - Blog">Blog</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/%E8%AE%A4%E8%AF%86%E7%AA%97%E5%8F%A3-%E7%AA%97%E5%8F%A3%E6%A8%A1%E5%BC%8F-%E7%AA%97%E5%8F%A3%E5%B1%82%E7%BA%A7android-12-csdn%E5%8D%9A%E5%AE%A2/ class=post-nav-item rel=prev title="【Android 12】认识窗口_android 窗口模式 窗口层级-CSDN博客"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>【Android 12】认识窗口_android 窗口模式 窗口层级-CSDN博客</a><a href=/posts/dataview-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/ class=post-nav-item rel=next title="Dataview 使用技巧">Dataview 使用技巧<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div class=post-reward><div class=comment></div><input type=checkbox class=reward-input name=reward id=fi-reward hidden>
<label class=reward-button for=fi-reward><i class="fa-solid fa-qrcode fa-fw" aria-hidden=true></i>赞赏</label><div class=reward-ways data-mode=static></div></div><div id=comments><div id=giscus class=comment><script src=https://giscus.app/client.js data-repo=huang8604/huang8604.github.io data-repo-id=R_kgDOMx3bEg data-category=Announcements data-category-id=DIC_kwDOMx3bEs4CigIp data-mapping=pathname data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.152.2"><img class=hugo-icon src=/images/hugo.min.svg alt="Hugo logo"> Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.3.20"><img class=fixit-icon src=/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2021 - 2025</span><span class=author itemprop=copyrightHolder>
<a href=https://github.com/huang8604 target=_blank rel="external nofollow noopener noreferrer">wentao</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><div id=mask></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=preload href=/lib/katex/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/katex/katex.min.css></noscript><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/instant-page/instantpage.min.js async defer type=module></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:199},comment:{enable:!0,expired:!1,giscus:{darkTheme:"dark",lightTheme:"light",origin:"https://giscus.app"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/search.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:50,threshold:.3,type:"fuse",useExtendedSearch:!1},version:"v0.3.20"}</script><script src=/js/theme.min.js defer></script><script src=/js/custom.min.js defer></script></body></html>