<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Archer&amp;ArcherIS AP签名方案总结 - 文韬的文档</title><meta name=author content="wentao"><meta name=description content=" 1 2 3 4 style: nestedList # TOC style (nestedList|inlineFirstLevel) maxLevel: 0 # Include headings up to the speficied level includeLinks: true # Make headings clickable debugInConsole: false # Print debug info in Obsidian console 关于AP端 HSM签名的配置说明 Archer 项目签名使用的加密狗来自YubiHSM
具体的一些操作说明需要到官网寻找：
YubiHSM2
"><meta name=keywords content='blog,实战'><meta itemprop=name content="Archer&ArcherIS AP签名方案总结"><meta itemprop=description content="1 2 3 4 style: nestedList # TOC style (nestedList|inlineFirstLevel) maxLevel: 0 # Include headings up to the speficied level includeLinks: true # Make headings clickable debugInConsole: false # Print debug info in Obsidian console 关于AP端 HSM签名的配置说明 Archer 项目签名使用的加密狗来自YubiHSM
具体的一些操作说明需要到官网寻找：
YubiHSM2"><meta itemprop=datePublished content="2024-11-06T06:57:56+00:00"><meta itemprop=dateModified content="2024-11-05T01:34:02+00:00"><meta itemprop=wordCount content="2295"><meta itemprop=keywords content="Blog,实战"><meta property="og:url" content="https://huang8604.github.io/posts/archerarcheris-ap%E7%AD%BE%E5%90%8D%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93/"><meta property="og:site_name" content="文韬的文档"><meta property="og:title" content="Archer&ArcherIS AP签名方案总结"><meta property="og:description" content="1 2 3 4 style: nestedList # TOC style (nestedList|inlineFirstLevel) maxLevel: 0 # Include headings up to the speficied level includeLinks: true # Make headings clickable debugInConsole: false # Print debug info in Obsidian console 关于AP端 HSM签名的配置说明 Archer 项目签名使用的加密狗来自YubiHSM
具体的一些操作说明需要到官网寻找：
YubiHSM2"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-06T06:57:56+00:00"><meta property="article:modified_time" content="2024-11-05T01:34:02+00:00"><meta property="article:tag" content="Blog"><meta property="article:tag" content="实战"><meta name=twitter:card content="summary"><meta name=twitter:title content="Archer&ArcherIS AP签名方案总结"><meta name=twitter:description content="1 2 3 4 style: nestedList # TOC style (nestedList|inlineFirstLevel) maxLevel: 0 # Include headings up to the speficied level includeLinks: true # Make headings clickable debugInConsole: false # Print debug info in Obsidian console 关于AP端 HSM签名的配置说明 Archer 项目签名使用的加密狗来自YubiHSM
具体的一些操作说明需要到官网寻找：
YubiHSM2"><meta name=application-name content="文涛的记录"><meta name=apple-mobile-web-app-title content="文涛的记录"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical type=text/html href=https://huang8604.github.io/posts/archerarcheris-ap%E7%AD%BE%E5%90%8D%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93/ title="Archer&amp;ArcherIS AP签名方案总结 - 文韬的文档"><link rel=prev type=text/html href=https://huang8604.github.io/posts/dataview-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/ title="dataview 使用技巧"><link rel=next type=text/html href=https://huang8604.github.io/posts/android%E7%B3%BB%E7%BB%9F%E7%8A%B6%E6%80%81%E6%A0%8F%E5%AE%9A%E5%88%B6/ title=Android系统状态栏定制><link rel=alternate type=text/markdown href=https://huang8604.github.io/posts/archerarcheris-ap%E7%AD%BE%E5%90%8D%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93/index.md title="Archer&ArcherIS AP签名方案总结 - 文韬的文档"><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Archer\u0026ArcherIS AP签名方案总结","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/huang8604.github.io\/posts\/archerarcheris-ap%E7%AD%BE%E5%90%8D%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93\/"},"genre":"posts","keywords":"blog, 实战","wordcount":2295,"url":"https:\/\/huang8604.github.io\/posts\/archerarcheris-ap%E7%AD%BE%E5%90%8D%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93\/","datePublished":"2024-11-06T06:57:56+00:00","dateModified":"2024-11-05T01:34:02+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"wentao"},"description":""}</script><script src=/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=wide><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=文韬的文档><img class=logo src=/images/doc.jpg alt=文韬的文档 height=32 width=32><span class=header-title-text>文韬的文档</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=文韬的文档><img class=logo src=/images/doc.jpg alt=文韬的文档 height=26 width=26><span class=header-title-text>文韬的文档</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Archer&amp;ArcherIS AP签名方案总结</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/huang8604 title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img class=avatar src='https://www.gravatar.com/avatar/b89538cdbc35c279ce1df9f3435f42a1?s=32&d=' alt=wentao height=16 width=16>&nbsp;wentao</a></span><span class=post-included-in>&nbsp;收录于 <a href=/categories/android/ class=post-category title="分类 - Android"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Android</a></span></div><div class=post-meta-line><span title="发布于 2024-11-06 06:57:56"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2024-11-06>2024-11-06</time></span>&nbsp;<span title="更新于 2024-11-05 01:34:02"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=2024-11-05>2024-11-05</time></span>&nbsp;<span title="2295 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 2300 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 5 分钟</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#关于ap端-hsm签名的配置说明>关于AP端 HSM签名的配置说明</a><ul><li><a href=#用于签名的hsm项目目前有>用于签名的HSM项目目前有:</a></li><li><a href=#编译的服务器分别在北京和沈阳>编译的服务器分别在北京和沈阳</a><ul><li><a href=#北京服务器>北京服务器</a><ul><li><a href=#一个加密狗-用于-archeris--serial0016980259>一个加密狗 用于 ArcherIS ==serial=0016980259==</a></li><li><a href=#一个加密狗-用于-archer---551>一个加密狗 用于 Archer ==551==</a></li></ul></li><li><a href=#沈阳服务器>沈阳服务器</a><ul><li><a href=#archer-a11的项目-561>Archer A11的项目 ==561==</a></li></ul></li></ul></li><li><a href=#对比总结>对比总结</a><ul><li><a href=#一-platform-key-与其他key>一 platform key 与其他key</a></li><li><a href=#二-release-key>二 release key</a></li><li><a href=#三-archer---551-的情况>三 Archer ==551== 的情况</a></li></ul></li></ul></li><li><a href=#签名方案>签名方案</a><ul><li><a href=#过往方案选择说明>过往方案选择说明</a></li><li><a href=#apk的签名工作>APK的签名工作</a></li><li><a href=#ota包的签名工作-采用官网提示进行签名>ota包的签名工作 采用官网提示进行签名</a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>style: nestedList # TOC style (nestedList|inlineFirstLevel)
</span></span><span class=line><span class=cl>maxLevel: 0 # Include headings up to the speficied level
</span></span><span class=line><span class=cl>includeLinks: true # Make headings clickable
</span></span><span class=line><span class=cl>debugInConsole: false # Print debug info in Obsidian console</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=关于ap端-hsm签名的配置说明><span>关于AP端 HSM签名的配置说明</span>
<a href=#%e5%85%b3%e4%ba%8eap%e7%ab%af-hsm%e7%ad%be%e5%90%8d%e7%9a%84%e9%85%8d%e7%bd%ae%e8%af%b4%e6%98%8e class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>Archer 项目签名使用的加密狗来自YubiHSM<br>具体的一些操作说明需要到官网寻找：<br><a href=https://developers.yubico.com/YubiHSM2/ target=_blank rel="external nofollow noopener noreferrer">YubiHSM2</a></p><h4 class=heading-element id=用于签名的hsm项目目前有><span>用于签名的HSM项目目前有:</span>
<a href=#%e7%94%a8%e4%ba%8e%e7%ad%be%e5%90%8d%e7%9a%84hsm%e9%a1%b9%e7%9b%ae%e7%9b%ae%e5%89%8d%e6%9c%89 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><ol><li>Archer A11</li><li>Archer A13</li><li>ArcherIS</li></ol><h4 class=heading-element id=编译的服务器分别在北京和沈阳><span>编译的服务器分别在北京和沈阳</span>
<a href=#%e7%bc%96%e8%af%91%e7%9a%84%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%88%86%e5%88%ab%e5%9c%a8%e5%8c%97%e4%ba%ac%e5%92%8c%e6%b2%88%e9%98%b3 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><h5 class=heading-element id=北京服务器><span>北京服务器</span>
<a href=#%e5%8c%97%e4%ba%ac%e6%9c%8d%e5%8a%a1%e5%99%a8 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>上插着两个加密狗</p><h6 class=heading-element id=一个加密狗-用于-archeris--serial0016980259><span>一个加密狗 用于 ArcherIS ==serial=0016980259==</span>
<a href=#%e4%b8%80%e4%b8%aa%e5%8a%a0%e5%af%86%e7%8b%97-%e7%94%a8%e4%ba%8e-archeris--serial0016980259 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h6><p>目前的usb serial no：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nv>connector</span><span class=o>=</span>yhusb://serial<span class=o>=</span><span class=m>0016980259</span></span></span></code></pre></td></tr></table></div></div><p>配置和密码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>pkcs11_section<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>engine_id</span> <span class=o>=</span> pkcs11
</span></span><span class=line><span class=cl><span class=c1>#dynamic_path = /usr/lib/ssl/engines/libpkcs11.so</span>
</span></span><span class=line><span class=cl><span class=nv>MODULE_PATH</span> <span class=o>=</span> /usr/lib/x86_64-linux-gnu/pkcs11/yubihsm_pkcs11.so
</span></span><span class=line><span class=cl><span class=nv>INIT_ARGS</span> <span class=o>=</span> <span class=s2>&#34;connector=yhusb://serial=0016980259&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># PIN is the &lt;key_id&gt;&lt;key-password&gt;, by default this is 0001password. Meaning the default key_id is &#39;0001&#39; and the default password is &#39;password&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># key_id = 0x2873 password = ef94cc600359806750df6595bbdf9652</span>
</span></span><span class=line><span class=cl><span class=c1># remove the 0x from the key_id and add the password to the end of it</span>
</span></span><span class=line><span class=cl><span class=c1># PIN = &lt;key_id&gt;&lt;password&gt;</span>
</span></span><span class=line><span class=cl><span class=c1># PIN = &lt;2873&gt;&lt;ef94cc600359806750df6595bbdf9652&gt;</span>
</span></span><span class=line><span class=cl><span class=c1># PIN = 5147bb4dc2069b1094a80b0311a91afd72f8</span>
</span></span><span class=line><span class=cl><span class=nv>PIN</span> <span class=o>=</span> <span class=s2>&#34;5147bb4dc2069b1094a80b0311a91afd72f8&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>init</span> <span class=o>=</span> <span class=m>0</span></span></span></code></pre></td></tr></table></div></div><p>列出里面的pkcs11 key的情况：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>builder@builder:~/archeris_hsm_apk_signer$ <span class=nv>YUBIHSM_PKCS11_CONF</span><span class=o>=</span>./conf/yubihsm_connector.conf keytool -list -keystore NONE -storetype PKCS11  -storepass 5147bb4dc2069b1094a80b0311a91afd72f8  -providerClass sun.security.pkcs11.SunPKCS11 -providerArg ./conf/hsm_config.conf 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Keystore type: PKCS11
</span></span><span class=line><span class=cl>Keystore provider: SunPKCS11-yubihsm-pkcs
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Your keystore contains <span class=m>9</span> entries
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>is_platform, PrivateKeyEntry, 
</span></span><span class=line><span class=cl>Certificate fingerprint <span class=o>(</span>SHA-256<span class=o>)</span>: 4A:EE:97:7C:1C:10:E4:1A:59:38:8F:3A:20:27:17:55:3C:EF:7E:7D:30:B4:10:B1:40:15:09:FC:4F:57:7D:79
</span></span><span class=line><span class=cl>media, PrivateKeyEntry, 
</span></span><span class=line><span class=cl>Certificate fingerprint <span class=o>(</span>SHA-256<span class=o>)</span>: 90:02:EB:69:82:F9:B8:F1:6A:0F:02:2F:03:0E:F8:AC:6E:78:27:41:86:D1:D8:0F:87:39:A1:2D:40:49:2F:1C
</span></span><span class=line><span class=cl>networkstack, PrivateKeyEntry, 
</span></span><span class=line><span class=cl>Certificate fingerprint <span class=o>(</span>SHA-256<span class=o>)</span>: B7:7A:E1:E4:80:90:73:DC:C2:D1:09:BB:E8:28:81:65:29:BF:97:7C:33:07:73:53:8C:67:11:14:F8:69:17:49
</span></span><span class=line><span class=cl>partner, PrivateKeyEntry, 
</span></span><span class=line><span class=cl>Certificate fingerprint <span class=o>(</span>SHA-256<span class=o>)</span>: 12:13:92:C9:91:78:7C:96:84:25:1C:A3:49:94:CF:E6:C8:E7:90:85:F7:E7:4D:15:A6:D9:D7:86:81:E1:51:51
</span></span><span class=line><span class=cl>platform, PrivateKeyEntry, 
</span></span><span class=line><span class=cl>Certificate fingerprint <span class=o>(</span>SHA-256<span class=o>)</span>: D8:4F:01:E6:6F:5E:CD:05:4A:B3:67:0F:EA:5A:E1:FA:EA:A7:73:04:A2:9D:F1:C2:59:48:09:52:E5:FB:C4:6B
</span></span><span class=line><span class=cl>release, PrivateKeyEntry, 
</span></span><span class=line><span class=cl>Certificate fingerprint <span class=o>(</span>SHA-256<span class=o>)</span>: 09:55:75:AE:AE:A3:AE:20:BB:B9:43:2C:1D:47:73:09:BC:E4:22:A0:F3:60:38:0F:E0:31:2F:2C:FE:27:D9:3F
</span></span><span class=line><span class=cl>shared, PrivateKeyEntry, 
</span></span><span class=line><span class=cl>Certificate fingerprint <span class=o>(</span>SHA-256<span class=o>)</span>: 84:CE:CB:ED:38:A7:00:AB:D1:E4:71:0C:8C:51:0D:3F:77:D6:B2:CB:72:B3:96:94:83:7A:A8:8A:FE:C2:93:9B
</span></span><span class=line><span class=cl>webview, PrivateKeyEntry, 
</span></span><span class=line><span class=cl>Certificate fingerprint <span class=o>(</span>SHA-256<span class=o>)</span>: 06:DC:3A:86:59:EF:66:95:5B:C6:18:37:A3:D1:F3:5D:44:18:01:59:43:0D:3B:27:ED:B6:A7:D5:80:0C:7A:EA
</span></span><span class=line><span class=cl>wrap_259, SecretKeyEntry, </span></span></code></pre></td></tr></table></div></div><p>用途：</p><ol><li>ArcherIS AP apk 签名</li><li>ArcherIS releasekey ota签名</li><li>Archer A13 AP apk 签名(计划中，验证中)</li></ol><p>Archer A13 目前延用A11 的项目 release ota 采用直接用releasekey的方案</p><h6 class=heading-element id=一个加密狗-用于-archer---551><span>一个加密狗 用于 Archer ==551==</span>
<a href=#%e4%b8%80%e4%b8%aa%e5%8a%a0%e5%af%86%e7%8b%97-%e7%94%a8%e4%ba%8e-archer---551 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>connector=yhusb://serial=0016499551</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>pkcs11_section<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>engine_id</span> <span class=o>=</span> pkcs11
</span></span><span class=line><span class=cl><span class=c1>#dynamic_path = /usr/lib/ssl/engines/libpkcs11.so</span>
</span></span><span class=line><span class=cl><span class=nv>dynamic_path</span> <span class=o>=</span> /usr/lib/x86_64-linux-gnu/openssl-1.0.0/engines/libpkcs11.so
</span></span><span class=line><span class=cl><span class=nv>MODULE_PATH</span> <span class=o>=</span> /usr/lib/x86_64-linux-gnu/pkcs11/yubihsm_pkcs11.so
</span></span><span class=line><span class=cl><span class=nv>PIN</span> <span class=o>=</span> <span class=s2>&#34;60d4458874be39d674225d861b3080f02068&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>INIT_ARGS</span> <span class=o>=</span> <span class=s2>&#34;connector=yhusb://serial=0016499551&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#INIT_ARGS = &#34;connector=http://localhost:12345&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>init</span> <span class=o>=</span> <span class=m>0</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>builder@builder:~/hsm_apk_signer$ <span class=nv>YUBIHSM_PKCS11_CONF</span><span class=o>=</span>./conf/yubihsm_connector.conf keytool -list -keystore NONE -storetype PKCS11  -storepass 60d4458874be39d674225d861b3080f02068  -providerClass sun.security.pkcs11.SunPKCS11 -providerArg ./conf/hsm_config.conf 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Keystore type: PKCS11
</span></span><span class=line><span class=cl>Keystore provider: SunPKCS11-yubihsm-pkcs
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Your keystore contains <span class=m>0</span> entries</span></span></code></pre></td></tr></table></div></div><p>用途：</p><ol><li>ArcherIS CP SecureBoot 应该也是用的该加密狗。</li><li>Archer A11 CP SecureBoot 应该也是用的该加密狗。</li><li>Archer A13 CP SecureBoot 应该也是用的该加密狗。</li></ol><h5 class=heading-element id=沈阳服务器><span>沈阳服务器</span>
<a href=#%e6%b2%88%e9%98%b3%e6%9c%8d%e5%8a%a1%e5%99%a8 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>上插着一个加密狗</p><h6 class=heading-element id=archer-a11的项目-561><span>Archer A11的项目 ==561==</span>
<a href=#archer-a11%e7%9a%84%e9%a1%b9%e7%9b%ae-561 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[pkcs11_section]
</span></span><span class=line><span class=cl>engine_id = pkcs11
</span></span><span class=line><span class=cl>#dynamic_path = /usr/lib/ssl/engines/libpkcs11.so
</span></span><span class=line><span class=cl>MODULE_PATH = /usr/lib/x86_64-linux-gnu/pkcs11/yubihsm_pkcs11.so
</span></span><span class=line><span class=cl>INIT_ARGS = &#34;connector=yhusb://serial=0016499561&#34;
</span></span><span class=line><span class=cl>PIN = &#34;2873ef94cc600359806750df6595bbdf9652&#34;
</span></span><span class=line><span class=cl>init = 0</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>builder@builder-PowerEdge-R740:~/hsm_apk_signer$ <span class=nv>YUBIHSM_PKCS11_CONF</span><span class=o>=</span>./conf/yubihsm_connector.conf keytool -list -keystore NONE -storetype PKCS11  -storepass 2873ef94cc600359806750df6595bbdf9652  -providerClass sun.security.pkcs11.SunPKCS11 -providerArg ./conf/hsm_config.conf 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Keystore type: PKCS11
</span></span><span class=line><span class=cl>Keystore provider: SunPKCS11-yubihsm-pkcs
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Your keystore contains <span class=m>6</span> entries
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>media, PrivateKeyEntry, 
</span></span><span class=line><span class=cl>Certificate fingerprint <span class=o>(</span>SHA-256<span class=o>)</span>: 90:02:EB:69:82:F9:B8:F1:6A:0F:02:2F:03:0E:F8:AC:6E:78:27:41:86:D1:D8:0F:87:39:A1:2D:40:49:2F:1C
</span></span><span class=line><span class=cl>networkstack, PrivateKeyEntry, 
</span></span><span class=line><span class=cl>Certificate fingerprint <span class=o>(</span>SHA-256<span class=o>)</span>: B7:7A:E1:E4:80:90:73:DC:C2:D1:09:BB:E8:28:81:65:29:BF:97:7C:33:07:73:53:8C:67:11:14:F8:69:17:49
</span></span><span class=line><span class=cl>platform, PrivateKeyEntry, 
</span></span><span class=line><span class=cl>Certificate fingerprint <span class=o>(</span>SHA-256<span class=o>)</span>: D8:4F:01:E6:6F:5E:CD:05:4A:B3:67:0F:EA:5A:E1:FA:EA:A7:73:04:A2:9D:F1:C2:59:48:09:52:E5:FB:C4:6B
</span></span><span class=line><span class=cl>release, PrivateKeyEntry, 
</span></span><span class=line><span class=cl>Certificate fingerprint <span class=o>(</span>SHA-256<span class=o>)</span>: 1A:0E:D4:92:DE:8E:A5:90:8A:51:BB:BA:80:70:F7:F7:CB:45:E0:3A:56:EB:19:D5:38:83:F3:EA:F0:2E:FA:AC
</span></span><span class=line><span class=cl>shared, PrivateKeyEntry, 
</span></span><span class=line><span class=cl>Certificate fingerprint <span class=o>(</span>SHA-256<span class=o>)</span>: 84:CE:CB:ED:38:A7:00:AB:D1:E4:71:0C:8C:51:0D:3F:77:D6:B2:CB:72:B3:96:94:83:7A:A8:8A:FE:C2:93:9B
</span></span><span class=line><span class=cl>wrapkey, SecretKeyEntry, 
</span></span><span class=line><span class=cl>builder@builder-PowerEdge-R740:~/hsm_apk_signer$ </span></span></code></pre></td></tr></table></div></div><p>用途：</p><ol><li>Archer A11 AP端apk 签名使用<br>Archer A11 release key 签名 仍然采用的releasekey 文件的形式签名。</li></ol><h4 class=heading-element id=对比总结><span>对比总结</span>
<a href=#%e5%af%b9%e6%af%94%e6%80%bb%e7%bb%93 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p><strong>从两个Usb key 导出的公钥来看，沈阳的加密狗561 和北京的加密狗259 里面存储的秘钥来看 meida platform share network 是一样的。</strong></p><h5 class=heading-element id=一-platform-key-与其他key><span>一 platform key 与其他key</span>
<a href=#%e4%b8%80-platform-key-%e4%b8%8e%e5%85%b6%e4%bb%96key class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p><strong>ArcherIS 采用来的 is_platform 来作为platform key的签名，<br>Archer 使用的是 platform 作为平台签名，北京259和沈阳561 的platform key 都可以使用<br>其余 media share network 的key 两个项目共用</strong></p><h5 class=heading-element id=二-release-key><span>二 release key</span>
<a href=#%e4%ba%8c-release-key class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p><strong>这两个加密狗里面 release key 是不一样的。<br>ArcherIS 使用了加密狗里面的key 作为ota的签名<br>Archer 使用的A11项目里面release key文件作为 release 签名(这个文件的来源目前不太清楚)</strong></p><h5 class=heading-element id=三-archer---551-的情况><span>三 Archer ==551== 的情况</span>
<a href=#%e4%b8%89-archer---551-%e7%9a%84%e6%83%85%e5%86%b5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p><strong>这个usb上面没有pkcs11的key</strong></p><h3 class=heading-element id=签名方案><span>签名方案</span>
<a href=#%e7%ad%be%e5%90%8d%e6%96%b9%e6%a1%88 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>关于HSM的签名方案，概要的说就是原来放在build/security/ 下面的 私钥和证书对。 客户由于安全的因素，不外发相关的私钥。<br>那么私钥通过写入 HSM 这种加密U盘(加密狗)，通过私钥去签名的工作，就交给了加密U盘来处理了。</p><p>那么在源码编译过程中使用了 build/security/ 下面key的工作有以下几点（CP端的镜像签名没有采用里面的key，有额外的key，在这里不讨论）</p><ol><li>APK的签名工作</li><li>ota包的签名工作</li></ol><h4 class=heading-element id=过往方案选择说明><span>过往方案选择说明</span>
<a href=#%e8%bf%87%e5%be%80%e6%96%b9%e6%a1%88%e9%80%89%e6%8b%a9%e8%af%b4%e6%98%8e class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>那么要做的工作就是把上面的两个签名流程，从本地签名修改到通过加密狗去签名。<br>那么之前的工程师在修改签名流程的时候遇到了一个问题，就是Android 源码的编译是多线程的，一般CPU 核心越多，线程越多。可能在编译apk的时候，会有多个应用去同时签名，而加密狗是一个单线程的签名系统。这里就会遇到冲突问题。</p><p>目前采取的方案，就是启动一个签名服务，用来提供签名工作，传入签名文件，和签名秘钥别名。把这些需求加入队列中，按照顺序去签名。这样就不会有冲突问题。</p><p>签名服务上传了源码，在项目路径：</p><div class="details admonition note open disabled"><div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden=true></i><br></div><div class=details-content><div class=admonition-content><p>build/soong/cmd/hsm_signer</p></div></div></div><h4 class=heading-element id=apk的签名工作><span>APK的签名工作</span>
<a href=#apk%e7%9a%84%e7%ad%be%e5%90%8d%e5%b7%a5%e4%bd%9c class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>hsm 上支持通过apksigner 进行 PKCS11 的签名，具体命令如下，里面包含了加密狗的 serial no，还有密码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span>sudo <span class=nv>YUBIHSM_PKCS11_CONF</span><span class=o>=</span>simt_connector.conf <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	/home/kailoma/Android/Sdk/build-tools/31.0.0/apksigner sign <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--provider-class sun.security.pkcs11.SunPKCS11 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--provider-arg simt_yubihsm.conf <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--ks NONE <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--ks-pass pass:5147bb4dc2069b1094a80b0311a91afd72f8 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--ks-type pkcs11 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--ks-key-alias &lt;key-alias&gt; <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--min-sdk-version <span class=m>17</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--max-sdk-version <span class=m>30</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--v1-signing-enabled <span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--v2-signing-enabled <span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	-v <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	-out &lt;path-to-output-apk-file&gt;-signed.apk <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	-in &lt;path-to-input-apk-file&gt;.apk<span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p>这部分实现是在加密服务里面，通常AOSP 编译是通过调用加密服务来实现的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl -d <span class=s2>&#34;key_alias=platform&amp;apk_unsigned_path=/home/builder/huangwentao/temp/CIT.apk&amp;apk_signed_path=/home/builder/huangwentao/temp/CIT_PLATFORM.apk&#34;</span> http://localhost:8886/hsm_apk_sign</span></span></code></pre></td></tr></table></div></div><p>这个例子里面就是：访问了 localhost 8886 端口的 hsm_apk_sign服务</p><p>然后在源码 SignApk.java 里面：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=n>ProcessBuilder</span><span class=w> </span><span class=n>processBuilder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ProcessBuilder</span><span class=p>();</span><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>processBuilder</span><span class=p>.</span><span class=na>command</span><span class=p>(</span><span class=s>&#34;bash&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;-c&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;curl -d \&#34;key_alias=&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>keyAlias</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;&amp;apk_unsigned_path=&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>unsignedApkPath</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;&amp;apk_signed_path=&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>signedApkPath</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;\&#34;  http://localhost:8886/hsm_apk_sign&#34;</span><span class=p>);</span><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Process</span><span class=w> </span><span class=n>process</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>processBuilder</span><span class=p>.</span><span class=na>start</span><span class=p>();</span><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>StringBuilder</span><span class=w> </span><span class=n>output</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringBuilder</span><span class=p>();</span><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>BufferedReader</span><span class=w> </span><span class=n>reader</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>BufferedReader</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>InputStreamReader</span><span class=p>(</span><span class=n>process</span><span class=p>.</span><span class=na>getInputStream</span><span class=p>()));</span><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>line</span><span class=p>;</span><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>((</span><span class=n>line</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>reader</span><span class=p>.</span><span class=na>readLine</span><span class=p>())</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>output</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>line</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;\n&#34;</span><span class=p>);</span><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h4 class=heading-element id=ota包的签名工作-采用官网提示进行签名><span>ota包的签名工作 采用官网提示进行签名</span>
<a href=#ota%e5%8c%85%e7%9a%84%e7%ad%be%e5%90%8d%e5%b7%a5%e4%bd%9c-%e9%87%87%e7%94%a8%e5%ae%98%e7%bd%91%e6%8f%90%e7%a4%ba%e8%bf%9b%e8%a1%8c%e7%ad%be%e5%90%8d class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>ota包的签名工作，不是调用apksigner</p><p>HSM官网的说明里面，pkcs11可以采用pkcs11-tool</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>export</span> <span class=nv>YUBIHSM_PKCS11_CONF</span><span class=o>=</span>~/huangwentao/qcm6490-archer-IS-00034-dev-r/build/soong/cmd/hsm_signer/conf/yubihsm_connector.conf
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>#-m SHA256-RSA-PKCS</span>
</span></span><span class=line><span class=cl>/usr/bin/pkcs11-tool --module /usr/lib/x86_64-linux-gnu/pkcs11/yubihsm_pkcs11.so --login -p 5147bb4dc2069b1094a80b0311a91afd72f8 --sign  --id <span class=m>0032</span> -i sig.bin -o signed-new.bin</span></span></code></pre></td></tr></table></div></div><p>ota的签名里面的sig.bin 就是针对payload.bin进行的sha256 hash值。所以在签名的时候，不用再加-m SHA256-RSA-PKCS，否则验签会出错。</p><p>编译整包的时候，会有sig.bin 以及签名文件sig_signed.bin 出来。我们通过 od -tx1 来查看二进制文件。</p><p> <br>sig.bin 二进制：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>builder@builder:~/huangwentao/buildtemp/after$ cat sig.bin <span class=p>|</span>od -tx1  
</span></span><span class=line><span class=cl><span class=m>0000000</span> <span class=m>05</span> ef dd <span class=m>77</span> 4f 7f 1d <span class=m>11</span> <span class=m>59</span> cc <span class=nb>fc</span> dd 9d c7 <span class=m>25</span> be  
</span></span><span class=line><span class=cl><span class=m>0000020</span> 2a a9 <span class=m>16</span> 5b 5d 9a dd <span class=m>32</span> 5b <span class=m>46</span> c6 f1 <span class=m>93</span> <span class=m>16</span> f0 8f  
</span></span><span class=line><span class=cl><span class=m>0000040</span></span></span></code></pre></td></tr></table></div></div><p>sig.bin hash256后的二进制：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>builder@builder:~/huangwentao/buildtemp/after$ openssl sha256 -binary sig.bin <span class=p>|</span>od -tx1  
</span></span><span class=line><span class=cl><span class=m>0000000</span> <span class=m>20</span> c3 0a eb ac <span class=m>21</span> 1f <span class=m>23</span> <span class=m>11</span> a4 8e dd <span class=m>66</span> 6e ae 1f  
</span></span><span class=line><span class=cl><span class=m>0000020</span> <span class=nb>fc</span> b5 <span class=m>72</span> fd 3f f8 <span class=m>15</span> <span class=m>09</span> e1 <span class=m>71</span> <span class=m>41</span> 1d fb <span class=m>21</span> <span class=m>93</span> e8  
</span></span><span class=line><span class=cl><span class=m>0000040</span></span></span></code></pre></td></tr></table></div></div><p>签名添加 sha256后的签名  /usr/bin/pkcs11-tool &ndash;module /usr/lib/x86_64-linux-gnu/pkcs11/yubihsm_pkcs11.so &ndash;login -p 5147bb4dc2069b1094a80b0311a91afd72f8 &ndash;sign  &ndash;id 0032 -m SHA256-RSA-PKCS -i sig.bin -o sig_signed256.bin<br>然后通过公钥去解码，发现和sig.bin  hash 256的是一致的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>builder@builder:~/huangwentao/buildtemp/after$ openssl rsautl -verify -pubin -inkey key-pub.key -in sig_signed256.bin <span class=p>|</span>od -tx1  
</span></span><span class=line><span class=cl><span class=m>0000000</span> <span class=m>30</span> <span class=m>31</span> <span class=m>30</span> 0d <span class=m>06</span> <span class=m>09</span> <span class=m>60</span> <span class=m>86</span> <span class=m>48</span> <span class=m>01</span> <span class=m>65</span> <span class=m>03</span> <span class=m>04</span> <span class=m>02</span> <span class=m>01</span> <span class=m>05</span>  
</span></span><span class=line><span class=cl><span class=m>0000020</span> <span class=m>00</span> <span class=m>04</span> <span class=m>20</span> <span class=m>20</span> c3 0a eb ac <span class=m>21</span> 1f <span class=m>23</span> <span class=m>11</span> a4 8e dd <span class=m>66</span>  
</span></span><span class=line><span class=cl><span class=m>0000040</span> 6e ae 1f <span class=nb>fc</span> b5 <span class=m>72</span> fd 3f f8 <span class=m>15</span> <span class=m>09</span> e1 <span class=m>71</span> <span class=m>41</span> 1d fb  
</span></span><span class=line><span class=cl><span class=m>0000060</span> <span class=m>21</span> <span class=m>93</span> e8</span></span></code></pre></td></tr></table></div></div><p>在main 函数里面添加参数，采用 pkcs11-tool 去签名</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>@@</span> <span class=o>-</span><span class=mi>1200</span><span class=p>,</span><span class=mi>6</span> <span class=o>+</span><span class=mi>1212</span><span class=p>,</span><span class=mi>21</span> <span class=o>@@</span> <span class=k>def</span> <span class=nf>GenerateAbOtaPackage</span><span class=p>(</span><span class=n>target_file</span><span class=p>,</span> <span class=n>output_file</span><span class=p>,</span> <span class=n>source_file</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> <span class=k>def</span> <span class=nf>main</span><span class=p>(</span><span class=n>argv</span><span class=p>):</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=o>+</span>  <span class=c1>#ArcherIs code for yubihsm by 00169 at 20230423 begin</span>
</span></span><span class=line><span class=cl><span class=o>+</span>  <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=s2>&#34;./.build_with_yubihsm&#34;</span><span class=p>)</span> <span class=p>:</span>
</span></span><span class=line><span class=cl><span class=o>+</span>    <span class=c1>#wentao</span>
</span></span><span class=line><span class=cl><span class=o>+</span>    <span class=n>cmd</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;pwd&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>+</span>    <span class=n>common</span><span class=o>.</span><span class=n>RunAndCheckOutput</span><span class=p>(</span><span class=n>cmd</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>+</span>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;hsm py version 002 yubihsm exist ,use yubihsm build tools pkcs11-tool instend &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>+</span>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;yubihsm before argv :&#34;</span><span class=p>,</span><span class=n>argv</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>+</span>    <span class=n>argv</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;-v&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>+</span>    <span class=n>argv</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;--payload_signer&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>+</span>    <span class=n>argv</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=s1>&#39;/usr/bin/pkcs11-tool&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>+</span>    <span class=c1>#argv.insert(3, &#39;--payload_signer_args=--module /usr/lib/x86_64-linux-gnu/pkcs11/yubihsm_pkcs11.so --login -p 5147bb4dc2069b1094a80b0311a91afd72f8 --sign -m SHA256-RSA-PKCS --id 0032&#39;)</span>
</span></span><span class=line><span class=cl><span class=o>+</span>    <span class=n>argv</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=s1>&#39;--payload_signer_args=--module /usr/lib/x86_64-linux-gnu/pkcs11/yubihsm_pkcs11.so --login -p 5147bb4dc2069b1094a80b0311a91afd72f8 --sign  --id 0032&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>+</span>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;yubihsm after args: &#34;</span><span class=p>,</span><span class=n>argv</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>+</span>  <span class=c1>#ArcherIs code for yubihsm by 00169 at 20230423 end</span>
</span></span><span class=line><span class=cl><span class=o>+</span>
</span></span><span class=line><span class=cl>   <span class=k>def</span> <span class=nf>option_handler</span><span class=p>(</span><span class=n>o</span><span class=p>,</span> <span class=n>a</span><span class=p>):</span>
</span></span><span class=line><span class=cl>     <span class=k>if</span> <span class=n>o</span> <span class=ow>in</span> <span class=p>(</span><span class=s2>&#34;-k&#34;</span><span class=p>,</span> <span class=s2>&#34;--package_key&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>       <span class=n>OPTIONS</span><span class=o>.</span><span class=n>package_key</span> <span class=o>=</span> <span class=n>a</span></span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2024-11-05 01:34:02">更新于 2024-11-05&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/archerarcheris-ap%E7%AD%BE%E5%90%8D%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://huang8604.github.io/posts/archerarcheris-ap%E7%AD%BE%E5%90%8D%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93/ data-title="Archer&amp;ArcherIS AP签名方案总结"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/blog/ class=post-tag title="标签 - Blog">Blog</a><a href=/tags/%E5%AE%9E%E6%88%98/ class=post-tag title="标签 - 实战">实战</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/dataview-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/ class=post-nav-item rel=prev title="Dataview 使用技巧"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Dataview 使用技巧</a><a href=/posts/android%E7%B3%BB%E7%BB%9F%E7%8A%B6%E6%80%81%E6%A0%8F%E5%AE%9A%E5%88%B6/ class=post-nav-item rel=next title=Android系统状态栏定制>Android系统状态栏定制<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div class=post-reward><div class=comment></div><input type=checkbox class=reward-input name=reward id=fi-reward hidden>
<label class=reward-button for=fi-reward><i class="fa-solid fa-qrcode fa-fw" aria-hidden=true></i>赞赏</label><div class=reward-ways data-mode=static></div></div><div id=comments><div id=giscus class=comment><script src=https://giscus.app/client.js data-repo=huang8604/huang8604.github.io data-repo-id=R_kgDOMx3bEg data-category=Announcements data-category-id=DIC_kwDOMx3bEs4CigIp data-mapping=pathname data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.152.2"><img class=hugo-icon src=/images/hugo.min.svg alt="Hugo logo"> Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.3.20"><img class=fixit-icon src=/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2021 - 2025</span><span class=author itemprop=copyrightHolder>
<a href=https://github.com/huang8604 target=_blank rel="external nofollow noopener noreferrer">wentao</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><div id=mask></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=preload href=/lib/katex/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/katex/katex.min.css></noscript><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/instant-page/instantpage.min.js async defer type=module></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:199},comment:{enable:!0,expired:!1,giscus:{darkTheme:"dark",lightTheme:"light",origin:"https://giscus.app"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/search.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:50,threshold:.3,type:"fuse",useExtendedSearch:!1},version:"v0.3.20"}</script><script src=/js/theme.min.js defer></script><script src=/js/custom.min.js defer></script></body></html>