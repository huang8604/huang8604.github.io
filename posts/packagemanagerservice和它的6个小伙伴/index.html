<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>PackageManagerService和它的6个“小伙伴” - 文韬的文档</title><meta name=author content="牛晓伟"><meta name=description content="前言
作为本系列文章的首篇文章，在开始之前我一直在思考，首篇文章应该写啥内容？才能让读者很容易明白PackageManagerService是啥呢，如何为后面文章起到承上启下的作用呢。
"><meta name=keywords content='clippings,转载,blog'><meta itemprop=name content="PackageManagerService和它的6个“小伙伴”"><meta itemprop=description content="前言
作为本系列文章的首篇文章，在开始之前我一直在思考，首篇文章应该写啥内容？才能让读者很容易明白PackageManagerService是啥呢，如何为后面文章起到承上启下的作用呢。"><meta itemprop=datePublished content="2024-11-06T06:57:53+00:00"><meta itemprop=dateModified content="2024-11-05T01:33:59+00:00"><meta itemprop=wordCount content="7891"><meta itemprop=keywords content="Clippings,转载,Blog"><meta property="og:url" content="https://huang8604.github.io/posts/packagemanagerservice%E5%92%8C%E5%AE%83%E7%9A%846%E4%B8%AA%E5%B0%8F%E4%BC%99%E4%BC%B4/"><meta property="og:site_name" content="文韬的文档"><meta property="og:title" content="PackageManagerService和它的6个“小伙伴”"><meta property="og:description" content="前言
作为本系列文章的首篇文章，在开始之前我一直在思考，首篇文章应该写啥内容？才能让读者很容易明白PackageManagerService是啥呢，如何为后面文章起到承上启下的作用呢。"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-06T06:57:53+00:00"><meta property="article:modified_time" content="2024-11-05T01:33:59+00:00"><meta property="article:tag" content="Clippings"><meta property="article:tag" content="转载"><meta property="article:tag" content="Blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="PackageManagerService和它的6个“小伙伴”"><meta name=twitter:description content="前言
作为本系列文章的首篇文章，在开始之前我一直在思考，首篇文章应该写啥内容？才能让读者很容易明白PackageManagerService是啥呢，如何为后面文章起到承上启下的作用呢。"><meta name=application-name content="文涛的记录"><meta name=apple-mobile-web-app-title content="文涛的记录"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical type=text/html href=https://huang8604.github.io/posts/packagemanagerservice%E5%92%8C%E5%AE%83%E7%9A%846%E4%B8%AA%E5%B0%8F%E4%BC%99%E4%BC%B4/ title="PackageManagerService和它的6个“小伙伴” - 文韬的文档"><link rel=prev type=text/html href=https://huang8604.github.io/posts/vsync%E4%B9%8Bapp%E5%B1%82%E9%9D%A2%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90-vsynceventdata-csdn%E5%8D%9A%E5%AE%A2/ title="Vsync之app层面深入分析  vsynceventdata-CSDN博客"><link rel=next type=text/html href=https://huang8604.github.io/posts/blastbufferqueue%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-csdn%E5%8D%9A%E5%AE%A2/ title=BLASTBufferQueue源码深入理解-CSDN博客><link rel=alternate type=text/markdown href=https://huang8604.github.io/posts/packagemanagerservice%E5%92%8C%E5%AE%83%E7%9A%846%E4%B8%AA%E5%B0%8F%E4%BC%99%E4%BC%B4/index.md title="PackageManagerService和它的6个“小伙伴” - 文韬的文档"><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"PackageManagerService和它的6个“小伙伴”","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/huang8604.github.io\/posts\/packagemanagerservice%E5%92%8C%E5%AE%83%E7%9A%846%E4%B8%AA%E5%B0%8F%E4%BC%99%E4%BC%B4\/"},"genre":"posts","keywords":"clippings, 转载, blog","wordcount":7891,"url":"https:\/\/huang8604.github.io\/posts\/packagemanagerservice%E5%92%8C%E5%AE%83%E7%9A%846%E4%B8%AA%E5%B0%8F%E4%BC%99%E4%BC%B4\/","datePublished":"2024-11-06T06:57:53+00:00","dateModified":"2024-11-05T01:33:59+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"牛晓伟"},"description":""}</script><script src=/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=wide><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=文韬的文档><img class=logo src=/images/doc.jpg alt=文韬的文档 height=32 width=32><span class=header-title-text>文韬的文档</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=文韬的文档><img class=logo src=/images/doc.jpg alt=文韬的文档 height=26 width=26><span class=header-title-text>文韬的文档</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>PackageManagerService和它的6个“小伙伴”</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
牛晓伟</span></span><span class=post-included-in>&nbsp;收录于 <a href=/collections/pms/ class=post-collection title="合集 - PMS"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> PMS</a></span></div><div class=post-meta-line><span title="发布于 2024-11-06 06:57:53"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2024-11-06>2024-11-06</time></span>&nbsp;<span title="更新于 2024-11-05 01:33:59"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=2024-11-05>2024-11-05</time></span>&nbsp;<span title="7891 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 7900 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 16 分钟</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#21-androidmanifestxml><strong>2.1 AndroidManifest.xml</strong></a></li><li><a href=#22-小结><strong>2.2 小结</strong></a></li><li><a href=#31-权限管理模块><strong>3.1 权限管理模块</strong></a></li><li><a href=#32-共享库模块><strong>3.2 共享库模块</strong></a><ul><li><ul><li><a href=#使用共享库><strong>使用共享库</strong></a></li></ul></li></ul></li><li><a href=#33-记录存储模块><strong>3.3 记录存储模块</strong></a></li><li><a href=#34-所有apk信息模块><strong>3.4 所有apk信息模块</strong></a></li><li><a href=#35-四大组件模块><strong>3.5 四大组件模块</strong></a></li><li><a href=#36-apk管理模块><strong>3.6 apk管理模块</strong></a><ul><li><a href=#361-apk安装><strong>3.6.1 apk安装</strong></a></li><li><a href=#362-apk的删除><strong>3.6.2 apk的删除</strong></a></li><li><a href=#363-扫描所有apk><strong>3.6.3 扫描所有apk</strong></a></li></ul></li><li><a href=#37-小结><strong>3.7 小结</strong></a></li><li><a href=#41-共享库模块初始化><strong>4.1 共享库模块初始化</strong></a></li><li><a href=#42-记录存储模块初始化><strong>4.2 记录存储模块初始化</strong></a></li><li><a href=#43-权限管理模块初始化><strong>4.3 权限管理模块初始化</strong></a></li><li><a href=#44-扫描apk><strong>4.4 扫描apk</strong></a></li><li><a href=#45-小结><strong>4.5 小结</strong></a></li></ul></nav></div></div><div class=content id=content><p><strong>前言</strong></p><p>作为本系列文章的首篇文章，在开始之前我一直在思考，首篇文章应该写啥内容？才能让读者很容易明白<strong>PackageManagerService</strong>是啥呢，如何为后面文章起到承上启下的作用呢。</p><p>后来我决定以介绍<strong>PackageManagerService</strong>服务中的各种繁多复杂的数据类为开篇，理由是数据类是基础，故数据类先行。遂开始一顿猛的输出，当即将接近尾声的时候，我发现不对啊，假如我是一个对<strong>PackageManagerService</strong>完全没接触的人，刚一上来就看到这么多非常陌生的数据类，那完全就是一种懵逼的感觉啊。</p><p>于是我决定重新规划，以介绍<strong>PackageManagerService</strong>及它包含的模块为首篇，这样即使对<strong>PackageManagerService</strong>陌生的人，也能先对它有一个初步的认识。同时后面的文章中会逐步深入的介绍<strong>PackageManagerService</strong>的内容。</p><p><strong>本文摘要</strong></p><p>这里的<strong>包管理</strong>指的是<strong>PackageManagerService</strong>这个服务，本篇是<strong>包管理</strong>系列文章的第一篇，既然整个系列文章都在介绍<strong>PackageManagerService</strong>，那本篇就带大家先认识一下<strong>PackageManagerService</strong>，通过本文您将了解<strong>PackageManagerService</strong>是啥，它被划分为哪些主要模块，这些模块之间又有啥关系。(文中代码基于Android13)</p><p><em>1</em></p><p>我是一个服务</p><p>大家好，我的名字叫<strong>PackageManagerService</strong>，如果觉得这名字太长大家可以叫我的小名<strong>PMS</strong>，我运行于<strong>systemserver</strong>进程，<strong>systemserver</strong>进程中有很多很多的<strong>服务</strong>，比如大家熟知的ActivityManagerService、WindowManagerService。而我也是一个<strong>服务</strong>，一个非常非常重要的<strong>服务</strong>。</p><p>上面多次提到一个词<strong>服务</strong>，那它到底意味着啥呢？那我就来给大家解释下，在Android中进程之间的通信用的最多的是鼎鼎大名的<strong>binder</strong>，而binder是client/server模式，也就是binder分为client端和server端，server端可以提供各种服务供多个client端使用。因此<strong>服务</strong>这个词就是指binder的server端，也就是说我PMS提供了<strong>包管理</strong>相关的功能，其他进程如果要想使用的话可以通过binder通信来“呼我”。</p><p>既然提到了<strong>包管理</strong>，其中<strong>包</strong>指的就是一个<strong>apk</strong>，那<strong>包管理</strong>也可以理解为<strong>对apk的管理</strong>，那PMS对apk主要进行以下几项管理：</p><ol><li>apk的安装/更新/卸载：这三件事情我全权交给<strong>PackageInstallerService</strong>，关于apk安装可以查看apk安装这篇文章。</li><li>apk信息查询，啥是apk信息查询呢？比如想要知道当前Android设备都安装了哪些apk，可以来我这取；再比如想要知道某个apk都包含了哪些四大组件，也可以来我这取。</li><li>apk权限管理，基本每个被安装的apk都是需要申请一些权限的，那这些权限是被用户授权了呢，还是被用户拒绝了呢，都可以来找我。我把这个事情交给<strong>PermissionManagerService</strong>来管理。</li></ol><p>可别小看了我，我可不是只负责上面的这些事情，只不过上面这些事情经常用到，故只罗列了它们而已。。我就是一个运行于<strong>systemserver</strong>进程<strong>对apk进行管理</strong>的非常重要的<strong>服务</strong>。</p><p>介绍完我自己，我觉得非常有必要介绍一下我管理的对象<strong>apk</strong>，你们人类有句话是这样说的：对自己的管理对象没有深入了解的领导不是一个好领导。并且对apk有一个深入了解后，再来理解我就更容易了。(对apk熟悉的话该部分可以跳过)</p><p><em>1</em></p><p>我管理的对象</p><p>我管理的对象<strong>apk</strong>，是 Android Package 的缩写，它其实是一个zip格式的压缩文件，只不过为了能让大家从文件名上一眼认出来，故文件后缀是 <strong>.apk</strong>。</p><p>贴心的我为了让大家更容易了解apk，故画了一幅图，下图展示了apk内包含的主要文件和目录。<br><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/11/6708edfacac5a.png title=image.png data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/11/6708edfacac5a.png data-sub-html="<h2>image.png</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/11/6708edfacac5a.png alt=image.png></a></p><p>图解</p><p><strong>lib目录</strong> 该目录下面包含了使用到的so库。</p><p><strong>res、assets目录</strong> 这两个目录下面包含了各种资源比如图片、layout文件等。</p><p><strong>META-INF</strong> 该目录下面包含了和签名证书有关的文件。</p><p><strong>dex</strong> java/kotlin编译后的字节码文件。</p><p><strong>resources.arsc</strong> 文件可以视为一个资源表，它存储了所有资源的ID和这些资源在APK文件或其他位置中的引用。</p><p><strong>AndroidManifest.xml</strong>需要着重介绍下，因为它对于我<strong>PMS</strong>来说非常重要。</p><h2 class=heading-element id=21-androidmanifestxml><span><strong>2.1 AndroidManifest.xml</strong></span>
<a href=#21-androidmanifestxml class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>可以在AndroidManifest.xml文件中使用<em>activity</em>、<em>provider</em>、<em>service</em>、<em>receiver</em>标签来声明四大组件，也可以使用<em>uses-permission</em>标签来申请使用哪些权限，当然还有其他的标签。</p><p>那AndroidManifest.xml和使用标签声明或者申请的这些信息到底是给谁用的呢？</p><p>答案是<strong>PMS</strong>，AndroidManifest.xml就像饭馆的菜单，从菜单上可以看出这个饭馆到底有哪些饭、菜，菜单是给顾客使用的。而AndroidManifest.xml是给<strong>PMS</strong>使用的，<strong>PMS</strong>只有通过<strong>AndroidManifest.xml才能知道一个apk内到底声明了哪些四大组件、申请了哪些权限、使用了哪些共享库等等</strong>，因此对于<strong>PMS</strong>可以通过<strong>解析AndroidManifest.xml内的各种标签</strong>来获取apk内声明的各种信息。</p><p>下图展示了AndroidManifest.xml中常用的标签。<br><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/11/6708ee45c91e9.png title=image.png data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/11/6708ee45c91e9.png data-sub-html="<h2>image.png</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/11/6708ee45c91e9.png alt=image.png></a></p><h2 class=heading-element id=22-小结><span><strong>2.2 小结</strong></span>
<a href=#22-%e5%b0%8f%e7%bb%93 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>我把我的管理对象<strong>apk</strong>介绍给了大家，其实我主要目的是想把apk中的<strong>AndroidManifest.xml</strong>着重介绍给大家，因为它对于我<strong>PMS</strong>来说非常重要，我只有通过它<strong>才能知道一个apk内到底声明了哪些四大组件、申请了哪些权限、使用了哪些共享库</strong>等等。</p><p>那接下来大家把“视线”再次聚焦到我身上，继续把我自己介绍给大家。</p><p><em>3</em></p><p>我的“小伙伴”</p><p>你们可不要把我想象的很厉害，很多工作都是由我和我的“小伙伴们”共同完成的，单凭我一个“人”可不行。为了让大家能更清楚的认识我的“小伙伴”，我用一张图把它们展示给大家。<br><a class=lightgallery href=https://picgo.myjojo.fun:666/i/2024/10/11/6708ee9ad0467.png title=f8954c9c5e52200a9f115a716afe453b\_MD5 data-thumbnail=https://picgo.myjojo.fun:666/i/2024/10/11/6708ee9ad0467.png data-sub-html="<h2>f8954c9c5e52200a9f115a716afe453b\_MD5</h2>"><img loading=lazy src=https://picgo.myjojo.fun:666/i/2024/10/11/6708ee9ad0467.png alt=f8954c9c5e52200a9f115a716afe453b\_MD5></a></p><p>我的主要“小伙伴”有<strong>apk管理模块</strong>、<strong>权限管理模块</strong>、<strong>共享库模块</strong>、<strong>记录存储模块</strong>、<strong>所有apk信息模块</strong>、<strong>四大组件模块</strong>。那我就把舞台交给它们，让它们亲自把自己介绍给大家吧。</p><h2 class=heading-element id=31-权限管理模块><span><strong>3.1 权限管理模块</strong></span>
<a href=#31-%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86%e6%a8%a1%e5%9d%97 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>大家好，我是<strong>权限管理模块</strong>，为了让大家更了解我的工作，我先来介绍下<strong>权限</strong>，权限分为<strong>声明权限</strong>和<strong>请求权限</strong>。</p><p>声明权限</p><p>还记得在上面介绍apk的AndroidManifest.xml的时候，声明权限需要在AndroidManifest.xml文件中使用<em>permission</em>标签，如下例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;permission</span> <span class=na>android:description=</span><span class=s>&#34;string resource&#34;</span>  
</span></span><span class=line><span class=cl>            <span class=na>android:icon=</span><span class=s>&#34;drawable resource&#34;</span>  
</span></span><span class=line><span class=cl>            <span class=na>android:label=</span><span class=s>&#34;string resource&#34;</span>  
</span></span><span class=line><span class=cl>            <span class=na>android:name=</span><span class=s>&#34;string&#34;</span>  
</span></span><span class=line><span class=cl>            <span class=na>android:permissionGroup=</span><span class=s>&#34;string&#34;</span>  
</span></span><span class=line><span class=cl>            <span class=na>android:protectionLevel=</span><span class=s>[&#34;normal&#34;</span> <span class=err>|</span> <span class=err>&#34;dangerous&#34;</span> <span class=err>|</span>  
</span></span><span class=line><span class=cl>                                     <span class=err>&#34;signature&#34;</span> <span class=err>|</span> <span class=err>...]</span> <span class=nt>/&gt;</span></span></span></code></pre></td></tr></table></div></div><p>每个apk都可以声明自己的权限，那当别的apk访问自己的一些关键信息时候就可以要求它具有某个声明的权限后才可以访问。</p><p>请求权限</p><p>每个安装在Android设备上的apk或多或少的都会用到一些权限，请求权限就是在AndroidManifest中通过<em>uses-permission</em>标签来使用权限，如下代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;uses-permission android:name=&#34;android.permission.READ_EXTERNAL_STORAGE&#34;/&gt;</span></span></code></pre></td></tr></table></div></div><p>而我<strong>权限管理模块</strong>所做的事情如下：</p><ol><li>把所有的apk<strong>声明的权限</strong>收集并集中管理起来</li><li>而<strong>每个apk请求的权限和权限对应的状态我也会保存起来</strong>，权限对应的状态是指比如某个apk的权限<em>是否被允许</em>、<em>是否拒绝</em>、<em>是否只是允许一次</em></li><li>apk在请求某个权限时，当用户不管是点击了<em>允许</em>、<em>拒绝</em>等，都需要经过我</li></ol><p>以上就是我所做的事情，而我把这些事情全权交给了<strong>PermissionManagerService</strong>服务来处理，关于我会在后面的文章再次与大家见面。</p><h2 class=heading-element id=32-共享库模块><span><strong>3.2 共享库模块</strong></span>
<a href=#32-%e5%85%b1%e4%ba%ab%e5%ba%93%e6%a8%a1%e5%9d%97 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>大家好，我是<strong>共享库模块</strong>，同样我也先来介绍下<strong>共享库</strong>，像<em>framework.jar</em>这个库包含了很多的类比如<em>Activity</em>、<em>Context</em>、<em>Service</em>等，而<em>framework.jar</em>在<strong>zygote</strong>进程中已经被预加载了，因此每个apk直接使用即可。而像一些库比如<em>com.google.android.maps</em>，它是没有被包含在<em>framework.jar</em>中的，而<em>com.google.android.maps</em>以共享库的方式提供给使用者来使用。而共享库也分为<strong>声明共享库</strong>和<strong>使用共享库</strong>。</p><p>声明共享库</p><p>首先只有系统apk才可以声明共享库，为啥有这样的规定？主要原因是既然是共享库就需要保证它的稳定性，如果是普通apk可以声明共享库，那设备上没有装该apk，那共享库就不存在。声明共享库非常简单在AndroidManifest.xml文件中使用<em>library</em>标签，如下例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;library android:name=&#34;android.ext.shared&#34; /&gt;</span></span></code></pre></td></tr></table></div></div><h4 class=heading-element id=使用共享库><span><strong>使用共享库</strong></span>
<a href=#%e4%bd%bf%e7%94%a8%e5%85%b1%e4%ba%ab%e5%ba%93 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>使用共享库在AndroidManifest.xml文件中使用<em>uses-library</em> (使用java库)或者<em>uses-native-library</em> (使用native库) 标签，如下例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;uses-library android:name=&#34;com.google.android.maps&#34;            android:required=&#34;false&#34; /&gt;&lt;uses-library android:name=&#34;com.here.android&#34;            android:required=&#34;false&#34; /&gt;</span></span></code></pre></td></tr></table></div></div><p>而我所做的事情如下：</p><ol><li>把所有<strong>声明的共享库</strong>收集起来，若共享库之间存在依赖，则把它们的依赖也初始化。</li><li>若apk中使用了共享库，则会把共享库的信息 (如共享库文件路径) 交给该apk。</li></ol><p>而我同样把这些事情交给了<strong>SharedLibrariesImpl</strong>类来处理，在后面的文章中我还会与大家见面。</p><h2 class=heading-element id=33-记录存储模块><span><strong>3.3 记录存储模块</strong></span>
<a href=#33-%e8%ae%b0%e5%bd%95%e5%ad%98%e5%82%a8%e6%a8%a1%e5%9d%97 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>大家好，我是<strong>记录存储模块</strong>，我的主要作用是记录信息并且把这些信息存储到文件中。</p><p><strong>PMS</strong>：“兄弟，你这样介绍自己，我想大家肯定不知道你说的是啥，最好介绍的时候带一些例子。”</p><p><strong>记录存储模块</strong>：“你说到即是，那我就重新介绍下我自己。”</p><p>首先我的名字主要是由<strong>记录</strong>和<strong>存储</strong>两个词组成的。<strong>记录</strong>主要是记录<strong>apk的安装信息</strong>、<strong>shared userId</strong>、<strong>apk声明的权限</strong>等。</p><p><strong>PMS</strong>：“那我替大家问个问题，像你说的这些信息不记录行不行。”</p><p><strong>记录存储模块</strong>：“答案是不记录肯定不行，为啥呢？如<strong>apk的安装信息</strong>指的是apk安装后是需要把它的关键信息用<em>PackageSetting</em>类记录下来的，就像你们人类入住酒店需要把身份证、房号等关键信息记录下来，而<em>PackageSetting</em>会把apk的包名、apk文件路径、apk的版本号及签名这些信息记录下来。记录下来后那其他使用者想要知道哪个apk是否安装了，就可以快速的从我这检索到。就像警察去某酒店查询某个人是否入住了酒店。”</p><p>那<strong>存储</strong>就是把记录的信息存储到文件中，存储到文件后在下次Android设备重新启动的时候就可以把存储的这些信息读取出来了。而我把我所做的这些事情交给了<strong>Settings</strong>类，在后面的文章中我会把我自己完完全全的介绍给大家，期待与大家见面。</p><h2 class=heading-element id=34-所有apk信息模块><span><strong>3.4 所有apk信息模块</strong></span>
<a href=#34-%e6%89%80%e6%9c%89apk%e4%bf%a1%e6%81%af%e6%a8%a1%e5%9d%97 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>大家好，我是<strong>所有apk信息模块</strong>，听着这个名字是不是很奇怪，主要的原因是我没有想到一个很好的名字，而我所做的事情是会把<strong>所有已安装apk的信息收集起来</strong>，还记得【2.我管理的对象】介绍apk中的<strong>AndroidManifest</strong>文件吗？这里的<strong>apk的信息</strong>指的就是<strong>解析AndroidManifest文件后的数据</strong>。通过这些信息可以知道apk的版本号、包名、application对应的class、声明了哪些四大组件、使用了哪些权限等等。</p><p>我的使用场景比较多，比如使用者可以从我这查询到<em>Application</em>的信息等，而我是存储在<strong>PMS</strong>的<em>mPackages</em>属性中，如下代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>//key是包名，而AndroidPackage存储了解析出的AndroidManifest的信息final WatchedArrayMap&lt;String, AndroidPackage&gt; mPackages = new WatchedArrayMap&lt;&gt;();</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=35-四大组件模块><span><strong>3.5 四大组件模块</strong></span>
<a href=#35-%e5%9b%9b%e5%a4%a7%e7%bb%84%e4%bb%b6%e6%a8%a1%e5%9d%97 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>大家好，我是<strong>四大组件模块</strong>，聪明的大家看了我的名字肯定能立马知道我是做啥的，我存储了<strong>所有已安装apk的AndroidManifest中声明的四大组件</strong>。</p><p><strong>PMS</strong>对<strong>四大组件模块</strong>说到：“我有个问题，<strong>所有apk信息模块</strong>不是已经把所有的信息都包含进去了，那为啥还需要你呢？你们不是包含了重复的信息吗？”</p><p>“我存在的目的是为了快速的检索四大组件，假如从<strong>所有apk信息模块</strong>检索某个<em>Activity</em>信息的话，需要通过<em>包名</em>从<em>mPackages</em>中获取对应的<em>AndroidPackage</em>对象，再从<em>AndroidPackage</em>对象中检索<em>Activity</em>，这个流程是不是比较长，而从<strong>四大组件模块</strong>检索速度非常快。这也就是我存在的目的。”</p><p>我常用于以下场景：</p><ol><li><em>ActivityTaskManagerService</em>启动某个<em>Activity</em>时，需要从我这获取对应的<em>Activity</em>信息，获取到则返回；否则启动<em>Activity</em>失效</li><li><em>ActivityManagerService</em>启动某个<em>Service</em>时，也需要从我这获取对应的<em>Service</em>信息。同理启动某个<em>BroadcastReceiver</em>、<em>ContentProvider</em>也需要从我哦这获取对应的信息</li></ol><p>而我是存储在<strong>PMS</strong>的<em>mComponentResolver</em>属性中，如下代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>final ComponentResolver mComponentResolver;</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=36-apk管理模块><span><strong>3.6 apk管理模块</strong></span>
<a href=#36-apk%e7%ae%a1%e7%90%86%e6%a8%a1%e5%9d%97 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>大家好，我是<strong>apk管理模块</strong>，从上图可以看出我在所有模块中的地位是多么重要，我把自己比作<strong>根基模块</strong>，毫不夸张的说没有我其他模块就没有存在的意义，我包含的功能有<strong>扫描所有apk</strong>、<strong>apk安装/更新/卸载</strong>、<strong>解析apk</strong>。那就来说下我为何有如此大的底气把自己说的如此重要。</p><h3 class=heading-element id=361-apk安装><span><strong>3.6.1 apk安装</strong></span>
<a href=#361-apk%e5%ae%89%e8%a3%85 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>安装一个apk后，如果apk中<strong>声明了权限</strong>或者<strong>使用了权限</strong>，则需要通知<strong>权限管理模块</strong>做相应的处理；如果apk是系统apk，使用了<em>library</em>标签<strong>声明了共享库</strong>，则需要通知<strong>共享库模块</strong>把声明的共享库收集起来；<strong>记录存储模块</strong>需要把该apk的关键信息记录并且存储下来；<strong>所有apk信息模块</strong>需要把该apk中AndroidManifest解析出来的信息存储下来；<strong>四大组件模块</strong>需要把该apk中声明的四大组件存储下来。</p><p>以上就是安装一个apk后，对其他模块产生的影响。</p><h3 class=heading-element id=362-apk的删除><span><strong>3.6.2 apk的删除</strong></span>
<a href=#362-apk%e7%9a%84%e5%88%a0%e9%99%a4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>删除一个apk后，如果apk中<strong>声明了权限</strong>或者<strong>使用了权限</strong>，则需要通知<strong>权限管理模块</strong>把相应的权限删除；如果apk是系统apk，使用了<em>library</em>标签<strong>声明了共享库</strong>，则需要通知<strong>共享库模块</strong>把声明的共享库删除；<strong>记录存储模块</strong>需要把该apk的关键信息删除；<strong>所有apk信息模块</strong>需要把该apk的信息删除；<strong>四大组件模块</strong>需要把该apk中声明的四大组件删除掉。</p><p>以上就是删除一个apk后，对其他模块产生的影响。</p><h3 class=heading-element id=363-扫描所有apk><span><strong>3.6.3 扫描所有apk</strong></span>
<a href=#363-%e6%89%ab%e6%8f%8f%e6%89%80%e6%9c%89apk class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>当Android设备启动的时候，会启动一个任务就是把所有的<strong>系统apk</strong>和<strong>非系统apk</strong>都扫描一下，扫描apk其中最重要的事情是解析apk的AndroidManifest文件，扫描apk所做的事情简单总结下就是：如果apk存在升级的情况则把apk升级，如果存在apk删除的情况则把apk删除，若存在一个新的系统apk则安装apk。因此扫描所有apk也会对其他模块产生影响。</p><p>以上的原因是不是完全可以说明我为啥是<strong>根基模块</strong>了，不管是<em>apk的安装</em>还是<em>apk的卸载</em>都会引起其他模块的“震动”，我把安装/卸载/更新apk的功能交给了<strong>PackageInstallerService</strong>这个服务，对apk安装感兴趣可以查看apk安装之谜这篇文章。</p><h2 class=heading-element id=37-小结><span><strong>3.7 小结</strong></span>
<a href=#37-%e5%b0%8f%e7%bb%93 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>我的“小伙伴”们都把它们自己介绍完毕了，那我简单总结下：</p><ol><li><strong>权限管理模块</strong>负责apk权限相关的事情，比如请求某个权限，apk权限状态存储，收集所有apk声明的权限</li><li><strong>共享库模块</strong>负责apk使用到的所有共享库</li><li><strong>记录存储模块</strong>会把apk相关的很多信息记录并且存储到文件中，比如apk安装后关于apk安装的信息会存储下来，这样就可以供其他使用者检索</li><li><strong>所有apk信息模块</strong>会收集所有已安装apk的AndroidManifest解析出来的信息，以供其他使用者检索</li><li><strong>四大组件模块</strong>为了加快检索四大组件的速度，会把所有已安装apk的四大组件信息收集起来</li><li><strong>apk管理模块</strong>主要负责apk的安装/卸载/更新，它是<strong>根基模块</strong>，因为它的某个功能会对其他模块产生影响。</li></ol><p><em>4</em></p><p>我的启动</p><p>介绍完我的“小伙伴”，那来介绍下我的启动过程，看下我的“小伙伴”在启动过程中做了什么？</p><h2 class=heading-element id=41-共享库模块初始化><span><strong>4.1 共享库模块初始化</strong></span>
<a href=#41-%e5%85%b1%e4%ba%ab%e5%ba%93%e6%a8%a1%e5%9d%97%e5%88%9d%e5%a7%8b%e5%8c%96 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p><strong>systemserver</strong>进程有很多很多的<strong>服务</strong>，而在<strong>systemserver</strong>进程启动过程中把这些服务分为了<strong>bootstrap services</strong>、<strong>core services</strong>、<strong>other services</strong>，而我非常的“荣幸”作为bootstrap services最先被启动，当我<strong>PMS</strong>的构造方法被调用后，<strong>共享库模块</strong>会先进行初始化，共享库既有java共享库也有native共享库，下面是相应的代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//下面代码位于PackageManagerService构造方法中  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>//从 SystemConfig.getInstance() 中把所有的lib读取出来  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>ArrayMap</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>SystemConfig</span><span class=p>.</span><span class=na>SharedLibraryEntry</span><span class=o>&gt;</span><span class=w> </span><span class=n>libConfig</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>systemConfig</span><span class=p>.</span><span class=na>getSharedLibraries</span><span class=p>();</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>builtInLibCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>libConfig</span><span class=p>.</span><span class=na>size</span><span class=p>();</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>builtInLibCount</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c1>//依次把存储在文件中的共享库添加到 mSharedLibraries 中  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>mSharedLibraries</span><span class=p>.</span><span class=na>addBuiltInSharedLibraryLPw</span><span class=p>(</span><span class=n>libConfig</span><span class=p>.</span><span class=na>valueAt</span><span class=p>(</span><span class=n>i</span><span class=p>));</span><span class=w>   
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kt>long</span><span class=w> </span><span class=n>undefinedVersion</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SharedLibraryInfo</span><span class=p>.</span><span class=na>VERSION_UNDEFINED</span><span class=p>;</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>//下面代码处理共享库之间的依赖  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>builtInLibCount</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>libConfig</span><span class=p>.</span><span class=na>keyAt</span><span class=p>(</span><span class=n>i</span><span class=p>);</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SystemConfig</span><span class=p>.</span><span class=na>SharedLibraryEntry</span><span class=w> </span><span class=n>entry</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>libConfig</span><span class=p>.</span><span class=na>valueAt</span><span class=p>(</span><span class=n>i</span><span class=p>);</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>dependencyCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entry</span><span class=p>.</span><span class=na>dependencies</span><span class=p>.</span><span class=na>length</span><span class=p>;</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>dependencyCount</span><span class=p>;</span><span class=w> </span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=kd>final</span><span class=w> </span><span class=n>SharedLibraryInfo</span><span class=w> </span><span class=n>dependency</span><span class=w> </span><span class=o>=</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>computer</span><span class=p>.</span><span class=na>getSharedLibraryInfo</span><span class=p>(</span><span class=n>entry</span><span class=p>.</span><span class=na>dependencies</span><span class=o>[</span><span class=n>j</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=n>undefinedVersion</span><span class=p>);</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>dependency</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=n>computer</span><span class=p>.</span><span class=na>getSharedLibraryInfo</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>undefinedVersion</span><span class=p>).</span><span class=na>addDependency</span><span class=p>(</span><span class=n>dependency</span><span class=p>);</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=42-记录存储模块初始化><span><strong>4.2 记录存储模块初始化</strong></span>
<a href=#42-%e8%ae%b0%e5%bd%95%e5%ad%98%e5%82%a8%e6%a8%a1%e5%9d%97%e5%88%9d%e5%a7%8b%e5%8c%96 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p><strong>记录存储模块</strong>会从先前存储好的文件中把各种信息读取出来，并交给对应的记录类，比如存储的所有apk的安装信息会从 package.xml 文件中读取出来，交给<em>PackageSetting</em>类；在比如<em>声明的权限</em>信息也从package.xml 文件中读取出来，交给<em>LegacyPermissionSettings</em>类。该模块提前初始化，主要是为后面的模块服务的，其他模块都需要知道哪些apk安装了等信息。下面是相应代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>//下面代码位于PackageManagerService构造方法中  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>//从 /data/system/packages.xml及其他文件中把保存的数据读出来  
</span></span><span class=line><span class=cl>mFirstBoot = !mSettings.readLPw(computer,    
</span></span><span class=line><span class=cl>                    mInjector.getUserManagerInternal().getUsers(  
</span></span><span class=line><span class=cl>                    /* excludePartial= */ true,  
</span></span><span class=line><span class=cl>                    /* excludeDying= */ false,  
</span></span><span class=line><span class=cl>                    /* excludePreCreated= */ false));</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=43-权限管理模块初始化><span><strong>4.3 权限管理模块初始化</strong></span>
<a href=#43-%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86%e6%a8%a1%e5%9d%97%e5%88%9d%e5%a7%8b%e5%8c%96 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>因为<strong>记录存储模块</strong>会把存储的权限信息读取出来，<strong>权限管理模块</strong>就可以使用这些信息来进行初始化了，下面是相应代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>//下面代码位于PackageManagerService构造方法中  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>//把所有apk声明的权限交给mPermissionManager  
</span></span><span class=line><span class=cl>mPermissionManager.readLegacyPermissionsTEMP(mSettings.mPermissions);   
</span></span><span class=line><span class=cl>//下面方法会使用每个apk的权限状态初始化自己  
</span></span><span class=line><span class=cl>mPermissionManager.readLegacyPermissionStateTEMP();</span></span></code></pre></td></tr></table></div></div><p>这样<strong>权限管理模块</strong>就可以接收权限管理方面的任务了。</p><h2 class=heading-element id=44-扫描apk><span><strong>4.4 扫描apk</strong></span>
<a href=#44-%e6%89%ab%e6%8f%8fapk class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>前面几个模块的初始化都是在为该步骤做准备，而扫描apk主要是把<strong>系统apk</strong>和<strong>非系统apk</strong>都扫描，扫描apk其实可以理解为是<strong>一个简单的apk安装或更新过程</strong>。扫描apk其中最重要的一步是需要把apk中AndroidManifest文件解析出来，在扫描过程是需要使用到<strong>记录存储模块</strong>来判断某个apk是否已经安装，同时还会用到<strong>共享库模块</strong>来判断是否有对应的共享库更新，同时也会用到<strong>权限管理模块</strong>来判断比如是否有新声明的权限加入。下面是扫描apk的对应代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>//下面代码位于PackageManagerService构造方法中  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>final int[] userIds = mUserManager.getUserIds();  
</span></span><span class=line><span class=cl>PackageParser2 packageParser = mInjector.getScanningCachingPackageParser();  
</span></span><span class=line><span class=cl>//扫描系统apk  
</span></span><span class=line><span class=cl>mOverlayConfig = mInitAppsHelper.initSystemApps(packageParser, packageSettings, userIds,startTime);   
</span></span><span class=line><span class=cl>//扫描非系统apk  
</span></span><span class=line><span class=cl>mInitAppsHelper.initNonSystemApps(packageParser, userIds, startTime);   
</span></span><span class=line><span class=cl>packageParser.close();</span></span></code></pre></td></tr></table></div></div><p>扫描apk后，<strong>所有apk信息模块</strong>和<strong>四大组件模块</strong>把所有已安装apk的信息收集起来，当然其他的模块也会进行相应的更新。</p><h2 class=heading-element id=45-小结><span><strong>4.5 小结</strong></span>
<a href=#45-%e5%b0%8f%e7%bb%93 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>以上就是我<strong>PMS</strong>启动过程中，模块之间初始化和互相影响的一个过程，当然上面只是列了关键模块，我的启动过程可不是只有这么简单，还有其他过程就不赘述了。</p><p><em>5</em></p><p>总结</p><p>本文主要带大家认识了<strong>PackageManagerService</strong>，它是一个运行于<strong>systemserver</strong>进程的<strong>管理apk的服务</strong>，还带大家认识了它的“小伙伴”<strong>权限管理模块</strong>、<strong>共享库模块</strong>、<strong>所有apk信息模块</strong>、<strong>四大组件模块</strong>、<strong>记录存储模块</strong>、<strong>apk管理模块</strong>，在后面的文章这些模块还会与大家见面。</p><p>这是<strong>包管理</strong>的第一篇，敬请期待我的第二篇，谢谢！</p><hr><p>最后推荐一下我做的网站，玩Android: <em>wanandroid.com</em> ，包含详尽的知识体系、好用的工具，还有本公众号文章合集，欢迎体验和收藏！</p></div><div class=collection-card><div class="collection-title text-secondary">收录于 <a href=/collections/pms/><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> <span>合集・PMS</span></span></a> 3</div><div class=collection-nav><a href=/posts/framework%E5%B1%82%E6%B7%BB%E5%8A%A0systemservice%E5%92%8Cmanager%E7%9A%84%E8%B6%85%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4_framework%E6%B7%BB%E5%8A%A0%E6%96%B0service-csdn%E5%8D%9A%E5%AE%A2/ class=collection-nav-item rel=prev title=Framework层添加SystemService和Manager的超详细步骤_framework添加新service-CSDN博客><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i><span>Framework层添加SystemService和Manager的超详细步骤_framework添加新service-CSDN博客</span>
</a><a href=/posts/xml-%E6%A0%BC%E5%BC%8F-%E7%9B%B8%E5%85%B3/ class=collection-nav-item rel=next title="Xml 格式 相关"><span>Xml 格式 相关</span><i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2024-11-05 01:33:59">更新于 2024-11-05&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/packagemanagerservice%E5%92%8C%E5%AE%83%E7%9A%846%E4%B8%AA%E5%B0%8F%E4%BC%99%E4%BC%B4/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://huang8604.github.io/posts/packagemanagerservice%E5%92%8C%E5%AE%83%E7%9A%846%E4%B8%AA%E5%B0%8F%E4%BC%99%E4%BC%B4/ data-title=PackageManagerService和它的6个“小伙伴”><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/clippings/ class=post-tag title="标签 - Clippings">Clippings</a><a href=/tags/%E8%BD%AC%E8%BD%BD/ class=post-tag title="标签 - 转载">转载</a><a href=/tags/blog/ class=post-tag title="标签 - Blog">Blog</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/vsync%E4%B9%8Bapp%E5%B1%82%E9%9D%A2%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90-vsynceventdata-csdn%E5%8D%9A%E5%AE%A2/ class=post-nav-item rel=prev title="Vsync之app层面深入分析  Vsynceventdata-CSDN博客"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Vsync之app层面深入分析 Vsynceventdata-CSDN博客</a><a href=/posts/blastbufferqueue%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-csdn%E5%8D%9A%E5%AE%A2/ class=post-nav-item rel=next title=BLASTBufferQueue源码深入理解-CSDN博客>BLASTBufferQueue源码深入理解-CSDN博客<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div class=post-reward><div class=comment></div><input type=checkbox class=reward-input name=reward id=fi-reward hidden>
<label class=reward-button for=fi-reward><i class="fa-solid fa-qrcode fa-fw" aria-hidden=true></i>赞赏</label><div class=reward-ways data-mode=static></div></div><div id=comments><div id=giscus class=comment><script src=https://giscus.app/client.js data-repo=huang8604/huang8604.github.io data-repo-id=R_kgDOMx3bEg data-category=Announcements data-category-id=DIC_kwDOMx3bEs4CigIp data-mapping=pathname data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.152.2"><img class=hugo-icon src=/images/hugo.min.svg alt="Hugo logo"> Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.3.20"><img class=fixit-icon src=/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2021 - 2025</span><span class=author itemprop=copyrightHolder>
<a href=https://github.com/huang8604 target=_blank rel="external nofollow noopener noreferrer">wentao</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><div id=mask></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=preload href=/lib/katex/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/katex/katex.min.css></noscript><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/instant-page/instantpage.min.js async defer type=module></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:199},comment:{enable:!0,expired:!1,giscus:{darkTheme:"dark",lightTheme:"light",origin:"https://giscus.app"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/search.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:50,threshold:.3,type:"fuse",useExtendedSearch:!1},version:"v0.3.20"}</script><script src=/js/theme.min.js defer></script><script src=/js/custom.min.js defer></script></body></html>